<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V3 çƒ­ç‚¹ä¸­å¿ƒ - HotNews Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .heat-explosive { border-left: 4px solid #ef4444; background: linear-gradient(90deg, #fef2f2 0%, transparent 100%); }
        .heat-hot { border-left: 4px solid #f97316; background: linear-gradient(90deg, #fff7ed 0%, transparent 100%); }
        .heat-warm { border-left: 4px solid #eab308; background: linear-gradient(90deg, #fefce8 0%, transparent 100%); }
        .heat-normal { border-left: 4px solid #22c55e; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">ğŸ”¥ V3 çƒ­ç‚¹ä¸­å¿ƒ</h1>
                        <p class="text-sm text-gray-500 mt-1">HotNews Center - å®æ—¶çƒ­æ¦œèšåˆ</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="refresh" :disabled="refreshing" 
                                class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400">
                            {{ refreshing ? 'åˆ·æ–°ä¸­...' : 'ğŸ”„ åˆ·æ–°' }}
                        </button>
                        <div class="text-sm text-gray-500">
                            æœ€åæ›´æ–°ï¼š{{ lastUpdate }}
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-6">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">æ€»çƒ­ç‚¹æ•°</div>
                    <div class="text-2xl font-bold text-blue-600">{{ stats.total || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">ğŸ”¥ çˆ†æ¬¾</div>
                    <div class="text-2xl font-bold text-red-600">{{ stats.explosive || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">çƒ­é—¨</div>
                    <div class="text-2xl font-bold text-orange-600">{{ stats.hot || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">å¹³å°æ•°</div>
                    <div class="text-2xl font-bold text-purple-600">{{ stats.platforms || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">è®¢é˜…æ•°</div>
                    <div class="text-2xl font-bold text-green-600">{{ stats.subscriptions || 0 }}</div>
                </div>
            </div>

            <!-- ç­›é€‰å™¨ -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-end">
                    <div class="flex-1 min-w-[200px]">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ” å…³é”®è¯æœç´¢</label>
                        <input v-model="filters.keyword" @keyup.enter="loadHotnews" type="text" 
                               placeholder="æœç´¢çƒ­ç‚¹..." class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å¹³å°</label>
                        <select v-model="filters.platform" @change="loadHotnews" class="border rounded px-3 py-2">
                            <option value="">å…¨éƒ¨å¹³å°</option>
                            <option v-for="p in platforms" :key="p" :value="p">{{ p }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†ç±»</label>
                        <select v-model="filters.category" @change="loadHotnews" class="border rounded px-3 py-2">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option v-for="c in categories" :key="c" :value="c">{{ c }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ—¶é—´</label>
                        <select v-model="filters.timeRange" @change="loadHotnews" class="border rounded px-3 py-2">
                            <option value="1h">æœ€è¿‘ 1 å°æ—¶</option>
                            <option value="6h">æœ€è¿‘ 6 å°æ—¶</option>
                            <option value="24h" selected>æœ€è¿‘ 24 å°æ—¶</option>
                            <option value="7d">æœ€è¿‘ 7 å¤©</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">çƒ­åº¦</label>
                        <select v-model="filters.minHeat" @change="loadHotnews" class="border rounded px-3 py-2">
                            <option value="0">å…¨éƒ¨çƒ­åº¦</option>
                            <option value="100000">ğŸ”¥ 10 ä¸‡+</option>
                            <option value="500000">ğŸ”¥ 50 ä¸‡+</option>
                            <option value="1000000">ğŸ”¥ 100 ä¸‡+</option>
                        </select>
                    </div>
                    <button @click="loadHotnews" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        ç­›é€‰
                    </button>
                </div>
            </div>

            <!-- çƒ­ç‚¹åˆ—è¡¨ -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                    <div>
                        <h2 class="text-lg font-semibold">çƒ­ç‚¹åˆ—è¡¨</h2>
                        <p class="text-sm text-gray-500">å…± {{ hotnews.length }} æ¡</p>
                    </div>
                    <div class="flex gap-2">
                        <button @click="toggleView('list')" :class="viewMode==='list'?'bg-blue-100':''" class="px-3 py-1 rounded">
                            ğŸ“‹ åˆ—è¡¨
                        </button>
                        <button @click="toggleView('grid')" :class="viewMode==='grid'?'bg-blue-100':''" class="px-3 py-1 rounded">
                            ğŸ“Š ç½‘æ ¼
                        </button>
                    </div>
                </div>
                
                <div v-if="loading" class="p-8 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="mt-2 text-gray-500">åŠ è½½ä¸­...</p>
                </div>

                <div v-else-if="hotnews.length === 0" class="p-8 text-center text-gray-500">
                    æš‚æ— çƒ­ç‚¹æ•°æ®ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°çƒ­ç‚¹
                </div>

                <!-- åˆ—è¡¨è§†å›¾ -->
                <div v-else-if="viewMode==='list'" class="divide-y divide-gray-200">
                    <div v-for="item in hotnews" :key="item.id" 
                         class="p-4 hover:bg-gray-50 cursor-pointer heat-{{ item.heat_level }}"
                         @click="showDetail(item)">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs px-2 py-0.5 rounded bg-gray-100">{{ item.platform }}</span>
                                    <span class="text-xs px-2 py-0.5 rounded bg-blue-100">{{ item.category }}</span>
                                    <span class="text-xs text-gray-500">{{ formatTime(item.publish_time) }}</span>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ item.title }}</h3>
                                <p class="text-sm text-gray-600 line-clamp-2">{{ item.content || item.description }}</p>
                            </div>
                            <div class="text-right ml-4">
                                <div class="text-lg font-bold" :class="getHeatColor(item.heat_count)">
                                    ğŸ”¥ {{ formatHeat(item.heat_count) }}
                                </div>
                                <div class="text-xs text-gray-500 mt-1">{{ item.heat_level }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç½‘æ ¼è§†å›¾ -->
                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
                    <div v-for="item in hotnews" :key="item.id" 
                         class="p-4 rounded-lg shadow hover:shadow-md cursor-pointer heat-{{ item.heat_level }}"
                         @click="showDetail(item)">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-0.5 rounded bg-gray-100">{{ item.platform }}</span>
                            <span class="text-xs px-2 py-0.5 rounded bg-blue-100">{{ item.category }}</span>
                        </div>
                        <h3 class="text-base font-semibold text-gray-900 mb-2 line-clamp-2">{{ item.title }}</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">{{ formatTime(item.publish_time) }}</span>
                            <span class="text-sm font-bold" :class="getHeatColor(item.heat_count)">
                                ğŸ”¥ {{ formatHeat(item.heat_count) }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é¡µ -->
                <div v-if="hotnews.length > 0" class="px-4 py-3 border-t border-gray-200 flex justify-between items-center">
                    <button @click="changePage(-1)" :disabled="page<=1" class="px-4 py-2 rounded border disabled:opacity-50">
                        â† ä¸Šä¸€é¡µ
                    </button>
                    <span class="text-sm text-gray-500">ç¬¬ {{ page }} é¡µ</span>
                    <button @click="changePage(1)" class="px-4 py-2 rounded border">
                        ä¸‹ä¸€é¡µ â†’
                    </button>
                </div>
            </div>
        </main>

        <!-- çƒ­ç‚¹è¯¦æƒ…å¼¹çª— -->
        <div v-if="selectedItem" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" @click.self="selectedItem=null">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-2">
                            <span class="text-sm px-2 py-1 rounded bg-gray-100">{{ selectedItem.platform }}</span>
                            <span class="text-sm px-2 py-1 rounded bg-blue-100">{{ selectedItem.category }}</span>
                        </div>
                        <button @click="selectedItem=null" class="text-gray-400 hover:text-gray-600">âœ•</button>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">{{ selectedItem.title }}</h2>
                    
                    <div class="flex items-center gap-4 mb-4 text-sm text-gray-500">
                        <span>ğŸ”¥ {{ formatHeat(selectedItem.heat_count) }}</span>
                        <span>ğŸ“… {{ formatTime(selectedItem.publish_time) }}</span>
                        <span>ğŸ• é‡‡é›†ï¼š{{ formatTime(selectedItem.crawl_time) }}</span>
                    </div>

                    <div class="prose max-w-none mb-4">
                        <p class="text-gray-700">{{ selectedItem.content || selectedItem.description }}</p>
                    </div>

                    <a :href="selectedItem.source_url" target="_blank" 
                       class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        ğŸ”— æŸ¥çœ‹åŸæ–‡
                    </a>

                    <div class="mt-6 flex gap-3">
                        <button @click="createTopic(selectedItem)" class="flex-1 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            ğŸ“ ä¸€é”®é€‰é¢˜
                        </button>
                        <button @click="subscribe(selectedItem)" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                            ğŸ”” è®¢é˜…
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    API_BASE: 'http://43.134.234.4:8000/api/v3',
                    loading: false,
                    refreshing: false,
                    hotnews: [],
                    selectedItem: null,
                    viewMode: 'list',
                    page: 1,
                    lastUpdate: '-',
                    stats: { total: 0, explosive: 0, hot: 0, platforms: 0, subscriptions: 0 },
                    filters: {
                        keyword: '',
                        platform: '',
                        category: '',
                        timeRange: '24h',
                        minHeat: '0'
                    },
                    platforms: ['å¾®åš', 'çŸ¥ä¹', 'B ç«™', 'æŠ–éŸ³', 'å¿«æ‰‹', 'å°çº¢ä¹¦', 'è±†ç“£', 'è™æ‰‘'],
                    categories: ['ç§‘æŠ€', 'æ•™è‚²', 'è´¢ç»', 'å¨±ä¹', 'ä½“è‚²', 'å¥åº·', 'èŒåœº', 'ç”Ÿæ´»']
                }
            },
            mounted() {
                this.loadHotnews();
                this.loadStats();
                // è‡ªåŠ¨åˆ·æ–° (5 åˆ†é’Ÿ)
                setInterval(() => {
                    this.refresh();
                }, 300000);
            },
            methods: {
                async loadHotnews() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.page,
                            page_size: 50,
                            ...this.filters
                        });
                        const res = await fetch(`${this.API_BASE}/hotnews?${params}`);
                        const data = await res.json();
                        this.hotnews = data.data || [];
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        console.error('åŠ è½½å¤±è´¥:', e);
                        // Mock æ•°æ® (API æœªå°±ç»ªæ—¶)
                        this.hotnews = this.getMockData();
                    } finally {
                        this.loading = false;
                    }
                },
                async loadStats() {
                    try {
                        const res = await fetch(`${this.API_BASE}/hotnews/statistics`);
                        const data = await res.json();
                        this.stats = data.data || this.stats;
                    } catch (e) {
                        console.error('ç»Ÿè®¡åŠ è½½å¤±è´¥:', e);
                    }
                },
                async refresh() {
                    this.refreshing = true;
                    await this.loadHotnews();
                    await this.loadStats();
                    this.refreshing = false;
                },
                showDetail(item) {
                    this.selectedItem = item;
                },
                createTopic(item) {
                    alert(`å·²åˆ›å»ºé€‰é¢˜ï¼š${item.title}\n(è·³è½¬åˆ°é€‰é¢˜æ¨¡å—)`);
                    // TODO: è·³è½¬åˆ°é€‰é¢˜æ¨¡å—
                },
                async subscribe(item) {
                    try {
                        await fetch(`${this.API_BASE}/hotnews/subscribe`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                keyword: item.title,
                                category: item.category
                            })
                        });
                        alert('âœ… è®¢é˜…æˆåŠŸ');
                        this.stats.subscriptions++;
                    } catch (e) {
                        alert('è®¢é˜…å¤±è´¥');
                    }
                },
                toggleView(mode) {
                    this.viewMode = mode;
                },
                changePage(delta) {
                    this.page += delta;
                    this.loadHotnews();
                },
                formatHeat(count) {
                    if (count >= 1000000) return (count/1000000).toFixed(1) + 'ä¸‡';
                    if (count >= 10000) return (count/10000).toFixed(1) + 'ä¸‡';
                    return count.toLocaleString();
                },
                getHeatColor(count) {
                    if (count >= 1000000) return 'text-red-600';
                    if (count >= 500000) return 'text-orange-600';
                    if (count >= 100000) return 'text-yellow-600';
                    return 'text-green-600';
                },
                formatTime(timeStr) {
                    if (!timeStr) return '-';
                    const date = new Date(timeStr);
                    return date.toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
                },
                getMockData() {
                    // Mock æ•°æ®ç”¨äºæ¼”ç¤º
                    return Array.from({length: 20}, (_, i) => ({
                        id: `mock_${i}`,
                        title: `çƒ­ç‚¹æ ‡é¢˜ç¤ºä¾‹ ${i+1} - AI æ•™è‚²å¼•å‘çƒ­è®®`,
                        content: 'è¿™æ˜¯çƒ­ç‚¹å†…å®¹æè¿°ï¼Œå±•ç¤ºçƒ­ç‚¹çš„æ ¸å¿ƒä¿¡æ¯å’Œå…³é”®è¦ç‚¹...',
                        platform: ['å¾®åš', 'çŸ¥ä¹', 'B ç«™', 'æŠ–éŸ³'][i%4],
                        category: ['ç§‘æŠ€', 'æ•™è‚²', 'è´¢ç»', 'å¨±ä¹'][i%4],
                        heat_count: Math.floor(Math.random() * 2000000),
                        heat_level: ['ğŸ”¥100 ä¸‡+', 'ğŸ”¥50 ä¸‡+', 'ğŸ”¥10 ä¸‡+', 'æ­£å¸¸'][i%4],
                        source_url: 'https://example.com',
                        publish_time: new Date().toISOString(),
                        crawl_time: new Date().toISOString()
                    }));
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
