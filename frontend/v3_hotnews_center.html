<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V3 çƒ­ç‚¹ä¸­å¿ƒ - HotNews Center</title>
    <link rel="stylesheet" href="css/v3-unified.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app" class="v3-layout">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <nav class="v3-navbar">
            <a href="v3_portal.html" class="v3-navbar-brand">
                <span class="v3-navbar-brand-logo">ğŸ”¥</span>
                <span class="v3-navbar-brand-label">çƒ­ç‚¹ä¸­å¿ƒ</span>
            </a>
            
            <div class="v3-navbar-nav">
                <a href="v3_portal.html" class="v3-navbar-link" data-module="portal">é—¨æˆ·</a>
                <a href="v3_coordinator.html" class="v3-navbar-link" data-module="coordinator">åè°ƒ</a>
                <a href="v3_workflow.html" class="v3-navbar-link" data-module="workflow">å·¥ä½œæµ</a>
                <a href="v3_publish_center.html" class="v3-navbar-link" data-module="publish">å‘å¸ƒ</a>
                <a href="v3_data_dashboard.html" class="v3-navbar-link active" data-module="data">æ•°æ®</a>
            </div>
            
            <div class="v3-navbar-actions">
                <button @click="refresh" :disabled="refreshing" class="v3-btn v3-btn-sm v3-btn-primary">
                    <i class="fas fa-sync" :class="{ 'fa-spin': refreshing }"></i> åˆ·æ–°
                </button>
                <span class="v3-text-sm v3-text-gray">æœ€åæ›´æ–°ï¼š{{ lastUpdate }}</span>
                <div class="v3-navbar-user">
                    <div class="v3-navbar-user-avatar">A</div>
                    <div class="v3-navbar-user-info">
                        <span class="v3-navbar-user-name">Admin</span>
                        <span class="v3-navbar-user-role">ç®¡ç†å‘˜</span>
                    </div>
                </div>
                <div class="v3-navbar-settings">
                    <i class="fas fa-cog"></i>
                </div>
            </div>
        </nav>

        <!-- ä¾§è¾¹æ  -->
        <aside class="v3-sidebar">
            <div class="v3-sidebar-content">
                <div class="v3-sidebar-section">
                    <div class="v3-sidebar-title">çƒ­ç‚¹ç®¡ç†</div>
                    <div class="v3-sidebar-menu">
                        <a href="#" class="v3-sidebar-item active">
                            <span class="v3-sidebar-item-icon"><i class="fas fa-fire"></i></span>
                            <span class="v3-sidebar-item-label">çƒ­ç‚¹åˆ—è¡¨</span>
                        </a>
                        <a href="#" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon"><i class="fas fa-chart-line"></i></span>
                            <span class="v3-sidebar-item-label">çƒ­åº¦åˆ†æ</span>
                        </a>
                        <a href="#" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon"><i class="fas fa-bell"></i></span>
                            <span class="v3-sidebar-item-label">è®¢é˜…ç®¡ç†</span>
                        </a>
                    </div>
                </div>
                
                <div class="v3-sidebar-section">
                    <div class="v3-sidebar-title">å¿«æ·å…¥å£</div>
                    <div class="v3-sidebar-menu">
                        <a href="v3_topic_intelligence.html" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon"><i class="fas fa-lightbulb"></i></span>
                            <span class="v3-sidebar-item-label">æ™ºèƒ½é€‰é¢˜</span>
                        </a>
                        <a href="v3_writing_factory.html" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon"><i class="fas fa-pen-fancy"></i></span>
                            <span class="v3-sidebar-item-label">å†™ä½œå·¥å‚</span>
                        </a>
                    </div>
                </div>
                
                <div class="v3-sidebar-status">
                    <div class="v3-sidebar-status-item">
                        <span class="v3-sidebar-status-label">æ•°æ®æº</span>
                        <span class="v3-status-indicator">
                            <span class="v3-status-dot success"></span>
                            <span class="v3-sidebar-status-value">æ­£å¸¸</span>
                        </span>
                    </div>
                    <div class="v3-sidebar-status-item">
                        <span class="v3-sidebar-status-label">å¹³å°æ•°</span>
                        <span class="v3-sidebar-status-value">{{ stats.platforms || 8 }}</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="v3-main">
            <div class="v3-content">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <div class="v3-breadcrumbs v3-mb-md">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <a href="v3_portal.html" class="v3-text-primary">é—¨æˆ·</a>
                        <span class="v3-text-gray">/</span>
                        <span class="v3-font-medium">çƒ­ç‚¹ä¸­å¿ƒ</span>
                    </span>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="v3-grid v3-grid-5 v3-mb-lg">
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">æ€»çƒ­ç‚¹æ•°</div>
                        <div class="v3-stat-value" style="color: var(--primary-600);">{{ stats.total || 0 }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">ğŸ”¥ çˆ†æ¬¾</div>
                        <div class="v3-stat-value" style="color: var(--danger-600);">{{ stats.explosive || 0 }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">çƒ­é—¨</div>
                        <div class="v3-stat-value" style="color: var(--warning-600);">{{ stats.hot || 0 }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">å¹³å°æ•°</div>
                        <div class="v3-stat-value" style="color: var(--secondary-600);">{{ stats.platforms || 0 }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">è®¢é˜…æ•°</div>
                        <div class="v3-stat-value" style="color: var(--success-600);">{{ stats.subscriptions || 0 }}</div>
                    </div>
                </div>

                <!-- ç­›é€‰å™¨ -->
                <div class="v3-card v3-mb-lg">
                    <div class="v3-card-body">
                        <div class="v3-flex v3-flex-col v3-gap-md" style="flex-wrap: wrap;">
                            <div class="v3-form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                                <label class="v3-form-label">ğŸ” å…³é”®è¯æœç´¢</label>
                                <input v-model="filters.keyword" @keyup.enter="loadHotnews" type="text" 
                                       placeholder="æœç´¢çƒ­ç‚¹..." class="v3-form-input">
                            </div>
                            <div class="v3-form-group" style="margin-bottom: 0;">
                                <label class="v3-form-label">å¹³å°</label>
                                <select v-model="filters.platform" @change="loadHotnews" class="v3-form-select">
                                    <option value="">å…¨éƒ¨å¹³å°</option>
                                    <option v-for="p in platforms" :key="p" :value="p">{{ p }}</option>
                                </select>
                            </div>
                            <div class="v3-form-group" style="margin-bottom: 0;">
                                <label class="v3-form-label">åˆ†ç±»</label>
                                <select v-model="filters.category" @change="loadHotnews" class="v3-form-select">
                                    <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                    <option v-for="c in categories" :key="c" :value="c">{{ c }}</option>
                                </select>
                            </div>
                            <div class="v3-form-group" style="margin-bottom: 0;">
                                <label class="v3-form-label">æ—¶é—´</label>
                                <select v-model="filters.timeRange" @change="loadHotnews" class="v3-form-select">
                                    <option value="1h">æœ€è¿‘ 1 å°æ—¶</option>
                                    <option value="6h">æœ€è¿‘ 6 å°æ—¶</option>
                                    <option value="24h" selected>æœ€è¿‘ 24 å°æ—¶</option>
                                    <option value="7d">æœ€è¿‘ 7 å¤©</option>
                                </select>
                            </div>
                            <div class="v3-form-group" style="margin-bottom: 0;">
                                <label class="v3-form-label">çƒ­åº¦</label>
                                <select v-model="filters.minHeat" @change="loadHotnews" class="v3-form-select">
                                    <option value="0">å…¨éƒ¨çƒ­åº¦</option>
                                    <option value="100000">ğŸ”¥ 10 ä¸‡+</option>
                                    <option value="500000">ğŸ”¥ 50 ä¸‡+</option>
                                    <option value="1000000">ğŸ”¥ 100 ä¸‡+</option>
                                </select>
                            </div>
                            <button @click="loadHotnews" class="v3-btn v3-btn-primary" style="align-self: flex-end;">
                                ç­›é€‰
                            </button>
                        </div>
                    </div>
                </div>

                <!-- çƒ­ç‚¹åˆ—è¡¨ -->
                <div class="v3-card">
                    <div class="v3-card-header">
                        <div>
                            <h3 class="v3-card-title">çƒ­ç‚¹åˆ—è¡¨</h3>
                            <p class="v3-text-sm v3-text-gray">å…± {{ hotnews.length }} æ¡</p>
                        </div>
                        <div class="v3-flex v3-gap-sm">
                            <button @click="toggleView('list')" :class="viewMode==='list' ? 'v3-btn-primary' : 'v3-btn-ghost'" class="v3-btn v3-btn-sm">
                                ğŸ“‹ åˆ—è¡¨
                            </button>
                            <button @click="toggleView('grid')" :class="viewMode==='grid' ? 'v3-btn-primary' : 'v3-btn-ghost'" class="v3-btn v3-btn-sm">
                                ğŸ“Š ç½‘æ ¼
                            </button>
                        </div>
                    </div>
                    
                    <div v-if="loading" class="v3-card-body" style="text-align: center; padding: 40px;">
                        <div class="v3-loading-spinner"></div>
                        <p class="v3-text-gray v3-mt-md">åŠ è½½ä¸­...</p>
                    </div>

                    <div v-else-if="hotnews.length === 0" class="v3-card-body" style="text-align: center; padding: 40px;">
                        <p class="v3-text-gray">æš‚æ— çƒ­ç‚¹æ•°æ®ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°çƒ­ç‚¹</p>
                    </div>

                    <!-- åˆ—è¡¨è§†å›¾ -->
                    <div v-else-if="viewMode==='list'" class="divide-y">
                        <div v-for="item in hotnews" :key="item.id" 
                             class="p-4 hover:bg-gray-50 cursor-pointer"
                             :style="getHeatStyle(item.heat_level)"
                             @click="showDetail(item)">
                            <div class="v3-flex v3-justify-between v3-items-start">
                                <div class="flex-1">
                                    <div class="v3-flex v3-gap-sm v3-items-center v3-mb-sm">
                                        <span class="v3-badge v3-badge-gray">{{ item.platform }}</span>
                                        <span class="v3-badge v3-badge-info">{{ item.category }}</span>
                                        <span class="v3-text-xs v3-text-gray">{{ formatTime(item.publish_time) }}</span>
                                    </div>
                                    <h3 class="v3-font-semibold v3-text-lg v3-mb-sm">{{ item.title }}</h3>
                                    <p class="v3-text-sm v3-text-gray line-clamp-2">{{ item.content || item.description }}</p>
                                </div>
                                <div class="text-right ml-4">
                                    <div class="v3-text-xl v3-font-bold" :class="getHeatColor(item.heat_count)">
                                        ğŸ”¥ {{ formatHeat(item.heat_count) }}
                                    </div>
                                    <div class="v3-text-xs v3-text-gray v3-mt-sm">{{ item.heat_level }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç½‘æ ¼è§†å›¾ -->
                    <div v-else class="v3-grid v3-grid-3 v3-p-lg">
                        <div v-for="item in hotnews" :key="item.id" 
                             class="v3-card v3-card-hover"
                             :style="getHeatStyle(item.heat_level)"
                             @click="showDetail(item)">
                            <div class="v3-card-body">
                                <div class="v3-flex v3-gap-sm v3-items-center v3-mb-md">
                                    <span class="v3-badge v3-badge-gray">{{ item.platform }}</span>
                                    <span class="v3-badge v3-badge-info">{{ item.category }}</span>
                                </div>
                                <h3 class="v3-font-semibold v3-mb-md line-clamp-2">{{ item.title }}</h3>
                                <div class="v3-flex v3-justify-between v3-items-center">
                                    <span class="v3-text-xs v3-text-gray">{{ formatTime(item.publish_time) }}</span>
                                    <span class="v3-text-sm v3-font-bold" :class="getHeatColor(item.heat_count)">
                                        ğŸ”¥ {{ formatHeat(item.heat_count) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <div v-if="hotnews.length > 0" class="v3-card-footer v3-flex v3-justify-between v3-items-center">
                        <button @click="changePage(-1)" :disabled="page<=1" class="v3-btn v3-btn-outline">
                            â† ä¸Šä¸€é¡µ
                        </button>
                        <span class="v3-text-sm v3-text-gray">ç¬¬ {{ page }} é¡µ</span>
                        <button @click="changePage(1)" class="v3-btn v3-btn-outline">
                            ä¸‹ä¸€é¡µ â†’
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- çƒ­ç‚¹è¯¦æƒ…å¼¹çª— -->
        <div v-if="selectedItem" class="v3-modal-overlay" @click.self="selectedItem=null">
            <div class="v3-modal">
                <div class="v3-card" style="max-width: 800px; width: 100%;">
                    <div class="v3-card-header">
                        <h3 class="v3-card-title">çƒ­ç‚¹è¯¦æƒ…</h3>
                        <button @click="selectedItem=null" class="v3-btn v3-btn-ghost v3-btn-icon">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="v3-card-body">
                        <div class="v3-flex v3-gap-sm v3-items-center v3-mb-md">
                            <span class="v3-badge v3-badge-gray">{{ selectedItem.platform }}</span>
                            <span class="v3-badge v3-badge-info">{{ selectedItem.category }}</span>
                        </div>
                        
                        <h2 class="v3-text-2xl v3-font-bold v3-mb-md">{{ selectedItem.title }}</h2>
                        
                        <div class="v3-flex v3-gap-md v3-items-center v3-text-sm v3-text-gray v3-mb-md">
                            <span>ğŸ”¥ {{ formatHeat(selectedItem.heat_count) }}</span>
                            <span>ğŸ“… {{ formatTime(selectedItem.publish_time) }}</span>
                            <span>ğŸ• é‡‡é›†ï¼š{{ formatTime(selectedItem.crawl_time) }}</span>
                        </div>

                        <div class="v3-p-md v3-bg-gray-50 v3-rounded v3-mb-md">
                            <p class="v3-text-gray-700">{{ selectedItem.content || selectedItem.description }}</p>
                        </div>

                        <a :href="selectedItem.source_url" target="_blank" class="v3-btn v3-btn-primary">
                            ğŸ”— æŸ¥çœ‹åŸæ–‡
                        </a>

                        <div class="v3-flex v3-gap-md v3-mt-lg">
                            <button @click="createTopic(selectedItem)" class="v3-btn v3-btn-success flex-1">
                                ğŸ“ ä¸€é”®é€‰é¢˜
                            </button>
                            <button @click="subscribe(selectedItem)" class="v3-btn v3-btn-secondary flex-1">
                                ğŸ”” è®¢é˜…
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/v3-common.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    API_BASE: 'http://43.134.234.4:8000/api/v3',
                    loading: false,
                    refreshing: false,
                    hotnews: [],
                    selectedItem: null,
                    viewMode: 'list',
                    page: 1,
                    lastUpdate: '-',
                    stats: { total: 0, explosive: 0, hot: 0, platforms: 0, subscriptions: 0 },
                    filters: {
                        keyword: '',
                        platform: '',
                        category: '',
                        timeRange: '24h',
                        minHeat: '0'
                    },
                    platforms: ['å¾®åš', 'çŸ¥ä¹', 'B ç«™', 'æŠ–éŸ³', 'å¿«æ‰‹', 'å°çº¢ä¹¦', 'è±†ç“£', 'è™æ‰‘'],
                    categories: ['ç§‘æŠ€', 'æ•™è‚²', 'è´¢ç»', 'å¨±ä¹', 'ä½“è‚²', 'å¥åº·', 'èŒåœº', 'ç”Ÿæ´»']
                }
            },
            mounted() {
                this.loadHotnews();
                this.loadStats();
                // è‡ªåŠ¨åˆ·æ–° (5 åˆ†é’Ÿ)
                setInterval(() => {
                    this.refresh();
                }, 300000);
                
                // åˆå§‹åŒ–å¯¼èˆª
                if (window.V3NavigationComponent) {
                    V3NavigationComponent.init('data');
                }
            },
            methods: {
                getHeatStyle(level) {
                    const styles = {
                        'ğŸ”¥100 ä¸‡+': { borderLeft: '4px solid #ef4444', background: 'linear-gradient(90deg, #fef2f2 0%, transparent 100%)' },
                        'ğŸ”¥50 ä¸‡+': { borderLeft: '4px solid #f97316', background: 'linear-gradient(90deg, #fff7ed 0%, transparent 100%)' },
                        'ğŸ”¥10 ä¸‡+': { borderLeft: '4px solid #eab308', background: 'linear-gradient(90deg, #fefce8 0%, transparent 100%)' },
                        'æ­£å¸¸': { borderLeft: '4px solid #22c55e' }
                    };
                    return styles[level] || {};
                },
                getHeatColor(count) {
                    if (count >= 1000000) return 'v3-text-danger';
                    if (count >= 500000) return 'v3-text-warning';
                    if (count >= 100000) return 'v3-text-yellow-600';
                    return 'v3-text-success';
                },
                async loadHotnews() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.page,
                            page_size: 50,
                            ...this.filters
                        });
                        const res = await fetch(`${this.API_BASE}/hotnews?${params}`);
                        const data = await res.json();
                        this.hotnews = data.data || [];
                        this.lastUpdate = new Date().toLocaleTimeString();
                    } catch (e) {
                        console.error('åŠ è½½å¤±è´¥:', e);
                        this.hotnews = this.getMockData();
                    } finally {
                        this.loading = false;
                    }
                },
                async loadStats() {
                    try {
                        const res = await fetch(`${this.API_BASE}/hotnews/statistics`);
                        const data = await res.json();
                        this.stats = data.data || this.stats;
                    } catch (e) {
                        console.error('ç»Ÿè®¡åŠ è½½å¤±è´¥:', e);
                    }
                },
                async refresh() {
                    this.refreshing = true;
                    await this.loadHotnews();
                    await this.loadStats();
                    this.refreshing = false;
                },
                showDetail(item) {
                    this.selectedItem = item;
                },
                createTopic(item) {
                    V3.Notification.success(`å·²åˆ›å»ºé€‰é¢˜ï¼š${item.title}`);
                    window.location.href = 'v3_topic_intelligence.html';
                },
                async subscribe(item) {
                    try {
                        await fetch(`${this.API_BASE}/hotnews/subscribe`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                keyword: item.title,
                                category: item.category
                            })
                        });
                        V3.Notification.success('è®¢é˜…æˆåŠŸ');
                        this.stats.subscriptions++;
                    } catch (e) {
                        V3.Notification.error('è®¢é˜…å¤±è´¥');
                    }
                },
                toggleView(mode) {
                    this.viewMode = mode;
                },
                changePage(delta) {
                    this.page += delta;
                    this.loadHotnews();
                },
                formatHeat(count) {
                    if (count >= 1000000) return (count/1000000).toFixed(1) + 'ä¸‡';
                    if (count >= 10000) return (count/10000).toFixed(1) + 'ä¸‡';
                    return count.toLocaleString();
                },
                formatTime(timeStr) {
                    if (!timeStr) return '-';
                    const date = new Date(timeStr);
                    return date.toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
                },
                getMockData() {
                    return Array.from({length: 20}, (_, i) => ({
                        id: `mock_${i}`,
                        title: `çƒ­ç‚¹æ ‡é¢˜ç¤ºä¾‹ ${i+1} - AI æ•™è‚²å¼•å‘çƒ­è®®`,
                        content: 'è¿™æ˜¯çƒ­ç‚¹å†…å®¹æè¿°ï¼Œå±•ç¤ºçƒ­ç‚¹çš„æ ¸å¿ƒä¿¡æ¯å’Œå…³é”®è¦ç‚¹...',
                        platform: ['å¾®åš', 'çŸ¥ä¹', 'B ç«™', 'æŠ–éŸ³'][i%4],
                        category: ['ç§‘æŠ€', 'æ•™è‚²', 'è´¢ç»', 'å¨±ä¹'][i%4],
                        heat_count: Math.floor(Math.random() * 2000000),
                        heat_level: ['ğŸ”¥100 ä¸‡+', 'ğŸ”¥50 ä¸‡+', 'ğŸ”¥10 ä¸‡+', 'æ­£å¸¸'][i%4],
                        source_url: 'https://example.com',
                        publish_time: new Date().toISOString(),
                        crawl_time: new Date().toISOString()
                    }));
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
