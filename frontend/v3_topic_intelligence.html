<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V3 æ™ºèƒ½é€‰é¢˜ - Topic Intelligence</title>
    <link rel="stylesheet" href="css/v3-design-tokens.css">
    <link rel="stylesheet" href="css/v3-unified.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" class="v3-layout">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        
        <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
        <nav class="v3-navbar" role="navigation" aria-label="ä¸»å¯¼èˆªæ ">
            <!-- Logo + å“ç‰Œå -->
            <a href="v3_portal.html" class="v3-navbar-brand">
                <span class="v3-navbar-brand-logo">ğŸ¯</span>
                <span class="v3-navbar-brand-label">æ™ºèƒ½é€‰é¢˜</span>
            </a>

            <!-- æ¨¡å—åˆ‡æ¢èœå• -->
            <div class="v3-navbar-nav">
                <a href="v3_portal.html" class="v3-navbar-link" data-module="portal">é—¨æˆ·</a>
                <a href="v3_coordinator.html" class="v3-navbar-link" data-module="coordinator">åè°ƒ</a>
                <a href="v3_workflow.html" class="v3-navbar-link" data-module="workflow">å·¥ä½œæµ</a>
                <a href="v3_publish_center.html" class="v3-navbar-link" data-module="publish">å‘å¸ƒ</a>
                <a href="v3_writing_factory.html" class="v3-navbar-link" data-module="writing">å†™ä½œ</a>
                <a href="v3_data_dashboard.html" class="v3-navbar-link " data-module="dashboard">æ•°æ®</a>
            </div>

            <!-- å³ä¾§æ“ä½œåŒº -->
            <div class="v3-navbar-actions">
                <!-- é€šçŸ¥ä¸­å¿ƒ -->
                <div class="v3-navbar-notification" role="button" tabindex="0" aria-label="é€šçŸ¥ä¸­å¿ƒ">
                    <svg class="v3-navbar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span class="v3-notification-badge" data-count="3">3</span>
                </div>

                <!-- ä¸»é¢˜åˆ‡æ¢ -->
                <button class="v3-navbar-theme-toggle" onclick="V3.Theme.toggle()" aria-label="åˆ‡æ¢ä¸»é¢˜" title="åˆ‡æ¢æ˜/æš—ä¸»é¢˜">
                    <svg class="v3-theme-icon v3-theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                    </svg>
                    <svg class="v3-theme-icon v3-theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>

                <!-- ç”¨æˆ·èœå• -->
                <div class="v3-navbar-user" role="button" tabindex="0" aria-haspopup="menu" aria-label="ç”¨æˆ·èœå•">
                    <div class="v3-navbar-user-avatar" id="navbar-user-avatar">A</div>
                    <div class="v3-navbar-user-info">
                        <span class="v3-navbar-user-name" id="navbar-user-name">Admin</span>
                        <span class="v3-navbar-user-role" id="navbar-user-role">ç®¡ç†å‘˜</span>
                    </div>
                    <svg class="v3-navbar-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m6 9 6 6 6-6"></path>
                    </svg>

                    <!-- ä¸‹æ‹‰èœå• -->
                    <div class="v3-user-dropdown" role="menu">
                        <a href="/profile" class="v3-dropdown-item" role="menuitem">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            ä¸ªäººä¸­å¿ƒ
                        </a>
                        <a href="/settings" class="v3-dropdown-item" role="menuitem">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            è®¾ç½®
                        </a>
                        <div class="v3-dropdown-divider"></div>
                        <button class="v3-dropdown-item v3-dropdown-logout" role="menuitem" onclick="V3.User.logout()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            é€€å‡ºç™»å½•
                        </button>
                    </div>
                </div>

                <!-- ç§»åŠ¨ç«¯æ±‰å ¡èœå• -->
                <button class="v3-navbar-menu-toggle" aria-label="èœå•" aria-expanded="false">
                    <span class="v3-menu-bar"></span>
                    <span class="v3-menu-bar"></span>
                    <span class="v3-menu-bar"></span>
                </button>
            </div>
        </nav>


        <!-- ä¾§è¾¹æ  -->
        
        <!-- ç»Ÿä¸€ä¾§è¾¹æ  -->
        <aside class="v3-sidebar" role="navigation" aria-label="ä¾§è¾¹å¯¼èˆª">
            <div class="v3-sidebar-content">
                <!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
                <button class="v3-sidebar-collapse-btn" onclick="V3.Sidebar.toggle()" aria-label="æŠ˜å ä¾§è¾¹æ " title="æŠ˜å /å±•å¼€">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>

                <!-- ä¸»å¯¼èˆªèœå• -->
                <div class="v3-sidebar-section">
                    <h3 class="v3-sidebar-title">ä¸»èœå•</h3>
                    <nav class="v3-sidebar-menu">
                        <a href="v3_portal.html" class="v3-sidebar-item" data-module="portal">
                            <span class="v3-sidebar-item-icon">ğŸ </span>
                            <span class="v3-sidebar-item-label">é—¨æˆ·é¦–é¡µ</span>
                        </a>
                        <a href="v3_coordinator.html" class="v3-sidebar-item" data-module="coordinator">
                            <span class="v3-sidebar-item-icon">ğŸ¤–</span>
                            <span class="v3-sidebar-item-label">æ™ºèƒ½åè°ƒ</span>
                        </a>
                        <a href="v3_workflow.html" class="v3-sidebar-item" data-module="workflow">
                            <span class="v3-sidebar-item-icon">ğŸ”„</span>
                            <span class="v3-sidebar-item-label">å·¥ä½œæµ</span>
                        </a>
                        <a href="v3_publish_center.html" class="v3-sidebar-item" data-module="publish">
                            <span class="v3-sidebar-item-icon">ğŸ“¤</span>
                            <span class="v3-sidebar-item-label">å‘å¸ƒä¸­å¿ƒ</span>
                        </a>
                        <a href="v3_writing_factory.html" class="v3-sidebar-item" data-module="writing">
                            <span class="v3-sidebar-item-icon">âœï¸</span>
                            <span class="v3-sidebar-item-label">å†™ä½œå·¥å‚</span>
                        </a>
                        <a href="v3_data_dashboard.html" class="v3-sidebar-item " data-module="dashboard">
                            <span class="v3-sidebar-item-icon">ğŸ“Š</span>
                            <span class="v3-sidebar-item-label">æ•°æ®çœ‹æ¿</span>
                        </a>
                    </nav>
                </div>

                <!-- é¡µé¢ç‰¹å®šèœå• -->
                <div class="v3-sidebar-section">
                    <h3 class="v3-sidebar-title">æ™ºèƒ½é€‰é¢˜</h3>
                    <nav class="v3-sidebar-menu">
                        
                        <a href="#" class="v3-sidebar-item active">
                            <span class="v3-sidebar-item-icon">ğŸ“‹</span>
                            <span class="v3-sidebar-item-label">é€‰é¢˜åˆ—è¡¨</span>
                        </a>
                        <a href="#" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon">ğŸ“Š</span>
                            <span class="v3-sidebar-item-label">é€‰é¢˜åˆ†æ</span>
                        </a>
                        <a href="#" class="v3-sidebar-item">
                            <span class="v3-sidebar-item-icon">âœ¨</span>
                            <span class="v3-sidebar-item-label">æ™ºèƒ½ç”Ÿæˆ</span>
                        </a>

                    </nav>
                </div>

                <!-- æœ€è¿‘è®¿é—® -->
                <div class="v3-sidebar-section">
                    <div class="v3-sidebar-header">
                        <h3 class="v3-sidebar-title">æœ€è¿‘è®¿é—®</h3>
                        <button class="v3-sidebar-clear-btn" onclick="V3.Sidebar.clearRecent()" aria-label="æ¸…ç©ºæœ€è¿‘è®¿é—®">æ¸…ç©º</button>
                    </div>
                    <nav class="v3-sidebar-menu" id="v3-sidebar-recent">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </nav>
                </div>

                <!-- ç³»ç»ŸçŠ¶æ€ -->
                <div class="v3-sidebar-section">
                    <h3 class="v3-sidebar-title">ç³»ç»ŸçŠ¶æ€</h3>
                    <div class="v3-sidebar-status">
                        <div class="v3-sidebar-status-item">
                            <span class="v3-sidebar-status-label">æœåŠ¡çŠ¶æ€</span>
                            <span class="v3-status-indicator">
                                <span class="v3-status-dot success"></span>
                                <span>è¿è¡Œä¸­</span>
                            </span>
                        </div>
                        <div class="v3-sidebar-status-item">
                            <span class="v3-sidebar-status-label">ä»Šæ—¥ä»»åŠ¡</span>
                            <span class="v3-sidebar-status-value" id="sidebar-task-count">12</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>


        <!-- ä¸»å†…å®¹åŒº -->
        <main class="v3-main">
            <div class="v3-content">

        <!-- ç»Ÿä¸€é¢åŒ…å±‘å¯¼èˆª -->
        <nav class="v3-breadcrumb" aria-label="é¢åŒ…å±‘å¯¼èˆª">
            <ol class="v3-breadcrumb-list">
                <li class="v3-breadcrumb-item">
                    <a href="v3_portal.html" class="v3-breadcrumb-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span>é¦–é¡µ</span>
                    </a>
                </li>
                <li class="v3-breadcrumb-item">
                    <span class="v3-breadcrumb-link">æ™ºèƒ½é€‰é¢˜</span>
                </li>
            </ol>
            <div class="v3-breadcrumb-actions">
                <button class="v3-breadcrumb-action-btn" onclick="window.location.reload()" aria-label="åˆ·æ–°" title="åˆ·æ–°">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
                <button class="v3-breadcrumb-action-btn" onclick="V3.Breadcrumb.share()" aria-label="åˆ†äº«" title="åˆ†äº«å½“å‰é¡µ">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                </button>
            </div>
        </nav>

                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <div class="v3-breadcrumbs v3-mb-md">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <a href="v3_portal.html" class="v3-text-primary">é—¨æˆ·</a>
                        <span class="v3-text-gray">/</span>
                        <span class="v3-font-medium">æ™ºèƒ½é€‰é¢˜</span>
                    </span>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="v3-grid v3-grid-5 v3-mb-lg">
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">æ€»é€‰é¢˜æ•°</div>
                        <div class="v3-stat-value" style="color: var(--primary-600);">{{ topics.length }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">S çº§çˆ†æ¬¾</div>
                        <div class="v3-stat-value" style="color: #f59e0b;">{{ countByGrade('S') }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">A çº§ä¼˜è´¨</div>
                        <div class="v3-stat-value" style="color: var(--primary-600);">{{ countByGrade('A') }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">B çº§åˆæ ¼</div>
                        <div class="v3-stat-value" style="color: var(--success-600);">{{ countByGrade('B') }}</div>
                    </div>
                    <div class="v3-stat-card">
                        <div class="v3-stat-label">å¹³å‡åˆ†</div>
                        <div class="v3-stat-value" style="color: var(--secondary-600);">{{ avgScore }}</div>
                    </div>
                </div>

                <!-- é€‰é¢˜åˆ—è¡¨ -->
                <div class="v3-card">
                    <div class="v3-card-header">
                        <div>
                            <h3 class="v3-card-title">é€‰é¢˜åˆ—è¡¨</h3>
                            <p class="v3-text-sm v3-text-gray">æ˜¾ç¤º {{ filteredTopics.length }} / {{ topics.length }} æ¡</p>
                        </div>
                        <div class="v3-flex v3-gap-sm">
                            <button @click="sortBy('score')" class="v3-btn v3-btn-sm v3-btn-ghost">
                                ğŸ“Š æŒ‰è¯„åˆ† {{ sortDir==='desc'?'â†“':'â†‘' }}
                            </button>
                            <button @click="sortBy('created_at')" class="v3-btn v3-btn-sm v3-btn-ghost">
                                ğŸ• æŒ‰æ—¶é—´
                            </button>
                            <button @click="exportTopics" class="v3-btn v3-btn-sm v3-btn-ghost">
                                ğŸ“¥ å¯¼å‡º
                            </button>
                        </div>
                    </div>

                    <div v-if="generating" class="v3-card-body" style="text-align: center; padding: 40px;">
                        <div class="v3-loading-spinner"></div>
                        <p class="v3-text-gray v3-mt-md">æ­£åœ¨ç”Ÿæˆé€‰é¢˜...</p>
                    </div>

                    <div v-else-if="filteredTopics.length === 0" class="v3-card-body" style="text-align: center; padding: 40px;">
                        <p class="v3-text-gray">æš‚æ— é€‰é¢˜ï¼Œç‚¹å‡»"æ‰¹é‡ç”Ÿæˆ"æŒ‰é’®åˆ›å»ºæ–°é€‰é¢˜</p>
                    </div>

                    <div v-else class="divide-y">
                        <div v-for="topic in filteredTopics" :key="topic.id" 
                             class="p-4 hover:bg-gray-50 cursor-pointer"
                             :style="getScoreStyle(topic.score.grade)"
                             @click="showDetail(topic)">
                            <div class="v3-flex v3-justify-between v3-items-start">
                                <div class="flex-1">
                                    <div class="v3-flex v3-gap-sm v3-items-center v3-mb-sm">
                                        <span class="v3-badge v3-badge-info">{{ getIndustryName(topic.industry) }}</span>
                                        <span class="v3-badge v3-badge-secondary">{{ getAngleName(topic.angle) }}</span>
                                        <span class="v3-text-xs v3-text-gray">{{ formatTime(topic.created_at) }}</span>
                                    </div>
                                    <h3 class="v3-font-semibold v3-text-lg v3-mb-sm">{{ topic.title }}</h3>
                                    <p class="v3-text-sm v3-text-gray line-clamp-2">{{ topic.description }}</p>
                                </div>
                                <div class="text-right ml-4">
                                    <div class="v3-text-2xl v3-font-bold" :class="getScoreColor(topic.score.total)">
                                        {{ topic.score.total }}
                                    </div>
                                    <div class="v3-text-sm v3-font-semibold" :class="getScoreColor(topic.score.total)">
                                        {{ topic.score.grade }}çº§
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- é€‰é¢˜è¯¦æƒ…å¼¹çª— -->
        <div v-if="selectedTopic" class="v3-modal-overlay" @click.self="selectedTopic=null">
            <div class="v3-modal">
                <div class="v3-card" style="max-width: 900px; width: 100%;">
                    <div class="v3-card-header">
                        <h3 class="v3-card-title">é€‰é¢˜è¯¦æƒ…</h3>
                        <button @click="selectedTopic=null" class="v3-btn v3-btn-ghost v3-btn-icon">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="v3-card-body">
                        <div class="v3-flex v3-justify-between v3-items-center v3-mb-md">
                            <div class="v3-flex v3-gap-sm">
                                <span class="v3-badge v3-badge-info">{{ getIndustryName(selectedTopic.industry) }}</span>
                                <span class="v3-badge v3-badge-secondary">{{ getAngleName(selectedTopic.angle) }}</span>
                            </div>
                            <div class="text-right">
                                <div class="v3-text-3xl v3-font-bold" :class="getScoreColor(selectedTopic.score.total)">
                                    {{ selectedTopic.score.total }}
                                </div>
                                <div class="v3-text-sm v3-text-gray">{{ selectedTopic.score.grade }}çº§</div>
                            </div>
                        </div>

                        <h2 class="v3-text-xl v3-font-bold v3-mb-md">{{ selectedTopic.title }}</h2>
                        <p class="v3-text-gray v3-mb-md">{{ selectedTopic.description }}</p>

                        <div class="v3-mb-md">
                            <h4 class="v3-font-semibold v3-mb-sm">ğŸ”‘ æ ¸å¿ƒè¦ç‚¹</h4>
                            <ul class="v3-list-disc v3-pl-md">
                                <li v-for="(point, i) in selectedTopic.key_points" :key="i" class="v3-text-sm v3-text-gray">
                                    {{ point }}
                                </li>
                            </ul>
                        </div>

                        <div class="v3-flex v3-gap-md v3-mt-lg">
                            <button @click="startWriting(selectedTopic)" class="v3-btn v3-btn-success flex-1">
                                âœï¸ å¼€å§‹å†™ä½œ
                            </button>
                            <button @click="deleteTopic(selectedTopic)" class="v3-btn v3-btn-danger">
                                ğŸ—‘ï¸ åˆ é™¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/v3-common.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    API_BASE: 'http://43.134.234.4:8000/api/v3',
                    generating: false,
                    topics: [],
                    filteredTopics: [],
                    selectedTopic: null,
                    sortDir: 'desc',
                    industries: [
                        { id: 'æ•™è‚²', name: 'ğŸ“ æ•™è‚²' },
                        { id: 'ç§‘æŠ€', name: 'ğŸ’» ç§‘æŠ€' },
                        { id: 'è´¢ç»', name: 'ğŸ’° è´¢ç»' },
                        { id: 'å¨±ä¹', name: 'ğŸ¬ å¨±ä¹' },
                        { id: 'ä½“è‚²', name: 'âš½ ä½“è‚²' },
                        { id: 'å¥åº·', name: 'ğŸ¥ å¥åº·' },
                        { id: 'èŒåœº', name: 'ğŸ’¼ èŒåœº' },
                        { id: 'ç”Ÿæ´»', name: 'ğŸ  ç”Ÿæ´»' }
                    ],
                    angles: [
                        { id: 'æ·±åº¦åˆ†æ', name: 'ğŸ” æ·±åº¦åˆ†æ' },
                        { id: 'æ•°æ®è§£è¯»', name: 'ğŸ“Š æ•°æ®è§£è¯»' },
                        { id: 'è§‚ç‚¹è¯„è®º', name: 'ğŸ’¡ è§‚ç‚¹è¯„è®º' },
                        { id: 'çŸ¥è¯†ç§‘æ™®', name: 'ğŸ“ çŸ¥è¯†ç§‘æ™®' }
                    ]
                }
            },
            computed: {
                avgScore() {
                    if (this.topics.length === 0) return 0;
                    const sum = this.topics.reduce((acc, t) => acc + t.score.total, 0);
                    return Math.round(sum / this.topics.length);
                }
            },
            mounted() {
                this.loadTopics();
            },
            methods: {
                getScoreStyle(grade) {
                    const styles = {
                        'S': { borderLeft: '4px solid #f59e0b', background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' },
                        'A': { borderLeft: '4px solid #3b82f6', background: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)' },
                        'B': { borderLeft: '4px solid #10b981', background: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' },
                        'C': { borderLeft: '4px solid #f59e0b', background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' }
                    };
                    return styles[grade] || {};
                },
                getScoreColor(score) {
                    if (score >= 85) return 'v3-text-warning';
                    if (score >= 75) return 'v3-text-primary';
                    if (score >= 60) return 'v3-text-success';
                    return 'v3-text-danger';
                },
                async loadTopics() {
                    try {
                        const res = await fetch(`${this.API_BASE}/topics`);
                        const data = await res.json();
                        this.topics = data.data || [];
                        this.filteredTopics = this.topics;
                    } catch (e) {
                        this.topics = this.getMockTopics();
                        this.filteredTopics = this.topics;
                    }
                },
                async generateTopics() {
                    this.generating = true;
                    try {
                        const res = await fetch(`${this.API_BASE}/topics/generate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ count: 20 })
                        });
                        const data = await res.json();
                        this.topics = [...data.data, ...this.topics];
                        this.filteredTopics = this.topics;
                        V3.Notification.success(`ç”Ÿæˆ ${data.data.length} ä¸ªé€‰é¢˜`);
                    } catch (e) {
                        const mock = this.getMockTopics(20);
                        this.topics = [...mock, ...this.topics];
                        this.filteredTopics = this.topics;
                        V3.Notification.success('ç”Ÿæˆ 20 ä¸ªé€‰é¢˜ (Mock)');
                    } finally {
                        this.generating = false;
                    }
                },
                sortBy(field) {
                    this.sortDir = this.sortDir === 'desc' ? 'asc' : 'desc';
                    this.filteredTopics.sort((a, b) => {
                        const aVal = a[field] || a.score[field];
                        const bVal = b[field] || b.score[field];
                        return this.sortDir === 'desc' ? bVal - aVal : aVal - bVal;
                    });
                },
                showDetail(topic) {
                    this.selectedTopic = topic;
                },
                startWriting(topic) {
                    V3.Notification.success(`å¼€å§‹å†™ä½œï¼š${topic.title}`);
                    window.location.href = 'v3_writing_factory.html';
                },
                deleteTopic(topic) {
                    if (confirm(`ç¡®å®šåˆ é™¤é€‰é¢˜ï¼š${topic.title}?`)) {
                        this.topics = this.topics.filter(t => t.id !== topic.id);
                        this.filteredTopics = this.filteredTopics.filter(t => t.id !== topic.id);
                        this.selectedTopic = null;
                        V3.Notification.success('é€‰é¢˜å·²åˆ é™¤');
                    }
                },
                exportTopics() {
                    const data = JSON.stringify(this.topics, null, 2);
                    V3.Utils.downloadFile(data, `topics_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
                    V3.Notification.success('é€‰é¢˜å·²å¯¼å‡º');
                },
                countByGrade(grade) {
                    return this.topics.filter(t => t.score.grade === grade).length;
                },
                getIndustryName(id) {
                    return this.industries.find(i => i.id === id)?.name || id;
                },
                getAngleName(id) {
                    return this.angles.find(a => a.id === id)?.name || id;
                },
                formatTime(timeStr) {
                    if (!timeStr) return '-';
                    const date = new Date(timeStr);
                    return date.toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
                },
                getMockTopics(count = 20) {
                    return Array.from({length: count}, (_, i) => ({
                        id: `topic_${i}`,
                        title: `AI æ•™è‚²${['æœºé‡','æŒ‘æˆ˜','å˜é©','æœªæ¥','è¶‹åŠ¿'][i%5]}ï¼š${['æ·±åº¦åˆ†æ','æ•°æ®è§£è¯»','è§‚ç‚¹è¯„è®º'][i%3]}`,
                        industry: ['æ•™è‚²', 'ç§‘æŠ€', 'è´¢ç»', 'èŒåœº'][i%4],
                        angle: ['æ·±åº¦åˆ†æ', 'æ•°æ®è§£è¯»', 'è§‚ç‚¹è¯„è®º', 'çŸ¥è¯†ç§‘æ™®'][i%4],
                        description: 'è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ½œåŠ›çš„é€‰é¢˜ï¼Œå€¼å¾—æ·±å…¥æ¢è®¨...',
                        key_points: ['è¦ç‚¹ 1', 'è¦ç‚¹ 2', 'è¦ç‚¹ 3'],
                        score: {
                            total: Math.floor(Math.random() * 40) + 60,
                            grade: ['S', 'A', 'B', 'C'][i%4]
                        },
                        created_at: new Date().toISOString()
                    }));
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
