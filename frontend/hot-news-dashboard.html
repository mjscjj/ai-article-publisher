<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­ç‚¹æ•°æ®å±•ç¤º - Hot News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .heat-explosive { border-left: 4px solid #ef4444; }
        .heat-hot { border-left: 4px solid #f97316; }
        .heat-warm { border-left: 4px solid #eab308; }
        .heat-normal { border-left: 4px solid #22c55e; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <h1 class="text-2xl font-bold text-gray-900">ğŸ”¥ çƒ­ç‚¹æ•°æ®å±•ç¤º</h1>
                <p class="text-sm text-gray-500 mt-1">Hot News Dashboard</p>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="max-w-7xl mx-auto px-4 py-6">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">æ€»çƒ­ç‚¹æ•°</div>
                    <div class="text-2xl font-bold text-blue-600">{{ stats.total_count || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">å¹³å‡çƒ­åº¦</div>
                    <div class="text-2xl font-bold text-orange-600">{{ stats.avg_heat || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">æœ€é«˜çƒ­åº¦</div>
                    <div class="text-2xl font-bold text-red-600">{{ stats.max_heat || 0 }}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">å”¯ä¸€çƒ­ç‚¹</div>
                    <div class="text-2xl font-bold text-green-600">{{ stats.unique_count || 0 }}</div>
                </div>
            </div>

            <!-- ç­›é€‰å™¨ -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-wrap gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†ç±»</label>
                        <select v-model="filters.category" @change="loadTopics" class="border rounded px-3 py-2">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">çƒ­åº¦ç­‰çº§</label>
                        <select v-model="filters.heat_level" @change="loadTopics" class="border rounded px-3 py-2">
                            <option value="">å…¨éƒ¨ç­‰çº§</option>
                            <option value="explosive">ğŸ”¥ çˆ†æ¬¾</option>
                            <option value="hot">ğŸ”¥ çƒ­é—¨</option>
                            <option value="warm">ğŸŒ¡ï¸ æ¸©çƒ­ç‚¹</option>
                            <option value="normal">ğŸ“Š æ™®é€š</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ—¶é—´èŒƒå›´</label>
                        <select v-model="filters.hours" @change="loadTopics" class="border rounded px-3 py-2">
                            <option value="">å…¨éƒ¨æ—¶é—´</option>
                            <option value="1">æœ€è¿‘ 1 å°æ—¶</option>
                            <option value="6">æœ€è¿‘ 6 å°æ—¶</option>
                            <option value="24">æœ€è¿‘ 24 å°æ—¶</option>
                            <option value="72">æœ€è¿‘ 3 å¤©</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- çƒ­ç‚¹åˆ—è¡¨ -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-4 py-3 border-b border-gray-200">
                    <h2 class="text-lg font-semibold">çƒ­ç‚¹åˆ—è¡¨</h2>
                    <p class="text-sm text-gray-500">å…± {{ topics.length }} æ¡</p>
                </div>
                
                <div v-if="loading" class="p-8 text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="mt-2 text-gray-500">åŠ è½½ä¸­...</p>
                </div>

                <div v-else-if="topics.length === 0" class="p-8 text-center text-gray-500">
                    æš‚æ— çƒ­ç‚¹æ•°æ®
                </div>

                <div v-else class="divide-y divide-gray-200">
                    <div v-for="topic in topics" :key="topic.id" 
                         class="p-4 hover:bg-gray-50 cursor-pointer heat-{{ topic.heat_level }}"
                         @click="showDetail(topic)">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-lg font-medium text-gray-900">{{ topic.title }}</h3>
                                <div class="mt-2 flex flex-wrap gap-2 text-sm">
                                    <span class="px-2 py-1 bg-gray-100 rounded">{{ topic.source_name || 'æœªçŸ¥æ¥æº' }}</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded">{{ topic.category || 'ç»¼åˆ' }}</span>
                                    <span class="px-2 py-1 bg-gray-100 rounded">{{ formatTime(topic.crawl_time) }}</span>
                                </div>
                                <div v-if="topic.tags && topic.tags.length" class="mt-2 flex flex-wrap gap-1">
                                    <span v-for="tag in topic.tags" :key="tag" 
                                          class="px-2 py-0.5 bg-purple-100 text-purple-800 text-xs rounded">
                                        {{ tag }}
                                    </span>
                                </div>
                            </div>
                            <div class="ml-4 text-right">
                                <div class="text-2xl font-bold" 
                                     :class="getHeatColor(topic.heat_score)">
                                    {{ topic.heat_score }}
                                </div>
                                <div class="text-xs text-gray-500">çƒ­åº¦å€¼</div>
                                <div class="mt-1 px-2 py-1 rounded text-xs"
                                     :class="getHeatLevelClass(topic.heat_level)">
                                    {{ getHeatLevelText(topic.heat_level) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çƒ­è¯äº‘ -->
            <div class="bg-white rounded-lg shadow mt-6">
                <div class="px-4 py-3 border-b border-gray-200">
                    <h2 class="text-lg font-semibold">çƒ­é—¨å…³é”®è¯</h2>
                </div>
                <div class="p-4">
                    <div class="flex flex-wrap gap-2">
                        <span v-for="kw in keywords.slice(0, 30)" :key="kw.keyword"
                              class="px-3 py-1.5 rounded-full text-sm"
                              :style="{ 
                                  backgroundColor: `rgba(59, 130, 246, ${Math.min(1, kw.count / 10)})`,
                                  color: 'white',
                                  fontSize: `${12 + Math.min(8, kw.count / 2)}px`
                              }">
                            {{ kw.keyword }} ({{ kw.count }})
                        </span>
                    </div>
                </div>
            </div>
        </main>

        <!-- è¯¦æƒ…å¼¹çª— -->
        <div v-if="selectedTopic" 
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
             @click="selectedTopic = null">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto" @click.stop>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-xl font-bold">{{ selectedTopic.title }}</h2>
                        <button @click="selectedTopic = null" class="text-gray-400 hover:text-gray-600">âœ•</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-gray-500">å†…å®¹</label>
                            <p class="mt-1 text-gray-900">{{ selectedTopic.content || 'æ— ' }}</p>
                        </div>
                        
                        <div v-if="selectedTopic.url">
                            <label class="text-sm font-medium text-gray-500">åŸæ–‡é“¾æ¥</label>
                            <a :href="selectedTopic.url" target="_blank" 
                               class="text-blue-600 hover:underline break-all">
                                {{ selectedTopic.url }}
                            </a>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">æ¥æº</label>
                                <p class="mt-1">{{ selectedTopic.source_name || 'æœªçŸ¥' }}</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-500">åˆ†ç±»</label>
                                <p class="mt-1">{{ selectedTopic.category || 'ç»¼åˆ' }}</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-500">çƒ­åº¦</label>
                                <p class="mt-1 font-bold" :class="getHeatColor(selectedTopic.heat_score)">
                                    {{ selectedTopic.heat_score }}
                                </p>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-500">é‡‡é›†æ—¶é—´</label>
                                <p class="mt-1">{{ formatTime(selectedTopic.crawl_time) }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ -->
        <footer class="bg-white border-t mt-8">
            <div class="max-w-7xl mx-auto px-4 py-4 text-center text-sm text-gray-500">
                Hot News Dashboard | Powered by FastAPI + Vue 3 + MySQL
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    apiBase: 'http://43.134.234.4:8080',
                    loading: false,
                    topics: [],
                    stats: {},
                    categories: [],
                    keywords: [],
                    selectedTopic: null,
                    filters: {
                        category: '',
                        heat_level: '',
                        hours: ''
                    }
                }
            },
            mounted() {
                this.loadTopics()
                this.loadStatistics()
                this.loadCategories()
                this.loadKeywords()
                
                // æ¯ 5 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
                setInterval(() => {
                    this.loadTopics()
                    this.loadStatistics()
                }, 300000)
            },
            methods: {
                async loadTopics() {
                    this.loading = true
                    try {
                        const params = new URLSearchParams()
                        params.set('limit', '50')
                        if (this.filters.category) params.set('category', this.filters.category)
                        if (this.filters.heat_level) params.set('heat_level', this.filters.heat_level)
                        if (this.filters.hours) params.set('hours', this.filters.hours)
                        
                        const res = await fetch(`${this.apiBase}/api/topics?${params}`)
                        const data = await res.json()
                        this.topics = data.data.topics || []
                    } catch (e) {
                        console.error('åŠ è½½çƒ­ç‚¹å¤±è´¥:', e)
                        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        this.topics = this.getMockTopics()
                    } finally {
                        this.loading = false
                    }
                },
                async loadStatistics() {
                    try {
                        const res = await fetch(`${this.apiBase}/api/statistics`)
                        const data = await res.json()
                        this.stats = data.data.overall || {}
                    } catch (e) {
                        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', e)
                    }
                },
                async loadCategories() {
                    try {
                        const res = await fetch(`${this.apiBase}/api/categories`)
                        const data = await res.json()
                        this.categories = data.data || []
                    } catch (e) {
                        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', e)
                    }
                },
                async loadKeywords() {
                    try {
                        const res = await fetch(`${this.apiBase}/api/keywords`)
                        const data = await res.json()
                        this.keywords = data.data || []
                    } catch (e) {
                        console.error('åŠ è½½å…³é”®è¯å¤±è´¥:', e)
                    }
                },
                showDetail(topic) {
                    this.selectedTopic = topic
                },
                formatTime(timeStr) {
                    if (!timeStr) return ''
                    const date = new Date(timeStr)
                    const now = new Date()
                    const diff = (now - date) / 1000 / 60 // åˆ†é’Ÿ
                    
                    if (diff < 60) return `${Math.floor(diff)}åˆ†é’Ÿå‰`
                    if (diff < 1440) return `${Math.floor(diff / 60)}å°æ—¶å‰`
                    return date.toLocaleDateString('zh-CN')
                },
                getHeatColor(score) {
                    if (score >= 90) return 'text-red-600'
                    if (score >= 75) return 'text-orange-600'
                    if (score >= 60) return 'text-yellow-600'
                    return 'text-green-600'
                },
                getHeatLevelClass(level) {
                    const classes = {
                        'explosive': 'bg-red-100 text-red-800',
                        'hot': 'bg-orange-100 text-orange-800',
                        'warm': 'bg-yellow-100 text-yellow-800',
                        'normal': 'bg-green-100 text-green-800'
                    }
                    return classes[level] || 'bg-gray-100 text-gray-800'
                },
                getHeatLevelText(level) {
                    const texts = {
                        'explosive': 'ğŸ”¥ çˆ†æ¬¾',
                        'hot': 'ğŸ”¥ çƒ­é—¨',
                        'warm': 'ğŸŒ¡ï¸ æ¸©çƒ­ç‚¹',
                        'normal': 'ğŸ“Š æ™®é€š'
                    }
                    return texts[level] || level
                },
                getMockTopics() {
                    // API ä¸å¯ç”¨æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    return [
                        {
                            id: 1,
                            title: 'æ•™è‚²éƒ¨å‘å¸ƒ AI+ æ•™è‚²æŒ‡å¯¼æ„è§ï¼Œ60% é«˜æ ¡å·²å¼€è®¾ç›¸å…³è¯¾ç¨‹',
                            content: 'æ•™è‚²éƒ¨è¿‘æ—¥å‘å¸ƒã€Šäººå·¥æ™ºèƒ½ + æ•™è‚²ã€‹æŒ‡å¯¼æ„è§...',
                            source_name: 'æ¾æ¹ƒæ–°é—»',
                            category: 'æ•™è‚²',
                            heat_score: 78.0,
                            heat_level: 'hot',
                            crawl_time: new Date().toISOString(),
                            tags: ['AI', 'æ•™è‚²', 'æ”¿ç­–']
                        },
                        {
                            id: 2,
                            title: 'AI ç¨‹åºå‘˜å¤±ä¸šæ½®æ¥äº†ï¼Ÿä¸“å®¶ï¼šä¸ä¼šç”¨ AI çš„æ‰ä¼šè¢«æ·˜æ±°',
                            content: 'è¿‘æ—¥ï¼ŒæŸå¤§å‚å®£å¸ƒè£å‘˜ 30%...',
                            source_name: 'çŸ¥ä¹çƒ­æ¦œ',
                            category: 'ç§‘æŠ€',
                            heat_score: 77.0,
                            heat_level: 'hot',
                            crawl_time: new Date().toISOString(),
                            tags: ['AI', 'å°±ä¸š', 'ç¨‹åºå‘˜']
                        }
                    ]
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
