<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œè¯„ä»· - V3 ç»Ÿä¸€é—¨æˆ·</title>
    <link rel="stylesheet" href="../css/v3-design-tokens.css">
    <link rel="stylesheet" href="../css/v3-unified.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
        <nav class="navbar bg-white shadow-md fixed top-0 left-0 right-0 z-50">
            <div class="navbar-brand px-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">ğŸ“Š</span>
                    <span class="text-xl font-bold text-gray-900">å·¥ä½œè¯„ä»·</span>
                </div>
                <button @click="toggleSidebar" class="md:hidden p-2 rounded hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
            </div>
            <div class="navbar-menu hidden md:flex px-4 space-x-4">
                <a v-for="module in modules" :key="module.id" :href="module.url" class="px-3 py-2 rounded hover:bg-gray-100">{{module.icon}} {{module.name}}</a>
            </div>
            <div class="navbar-actions px-4 flex items-center space-x-3">
                <button @click="toggleTheme" class="p-2 rounded hover:bg-gray-100">{{isDark ? 'â˜€ï¸' : 'ğŸŒ™'}}</button>
                <div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center text-white font-semibold">U</div>
            </div>
        </nav>

        <!-- ä¾§è¾¹æ  -->
        <aside :class="['sidebar fixed left-0 top-16 bottom-0 w-64 bg-white shadow-lg transform transition-transform z-40', isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0']">
            <div class="sidebar-menu p-4 space-y-2">
                <a v-for="item in sidebarItems" :key="item.id" :href="item.url" class="block px-4 py-2 rounded hover:bg-gray-100">{{item.icon}} {{item.name}}</a>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content ml-0 md:ml-64 mt-16 p-6">
            <div class="breadcrumb mb-4 flex items-center space-x-2 text-sm text-gray-600">
                <a href="v3_portal_v2.html" class="hover:text-primary-500">é¦–é¡µ</a><span>/</span><span class="text-gray-900 font-medium">å·¥ä½œè¯„ä»·</span>
            </div>

            <div class="page-content space-y-6">
                <!-- è¯„ä»·è¾“å…¥ -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">ğŸ“ æ–°å»ºè¯„ä»·</h2>
                    <div class="flex gap-4 mb-4">
                        <button @click="evalType='article'" :class="evalType==='article'?'bg-blue-600 text-white':'bg-gray-100'" class="px-4 py-2 rounded">ğŸ“„ æ–‡ç« è¯„ä»·</button>
                        <button @click="evalType='topic'" :class="evalType==='topic'?'bg-blue-600 text-white':'bg-gray-100'" class="px-4 py-2 rounded">ğŸ¯ é€‰é¢˜è¯„ä»·</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æ ‡é¢˜</label>
                            <input v-model="inputTitle" type="text" class="w-full border rounded px-3 py-2" placeholder="è¾“å…¥æ ‡é¢˜...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{evalType==='article'?'æ–‡ç« å†…å®¹':'é€‰é¢˜æè¿°'}}</label>
                            <textarea v-model="inputContent" rows="6" class="w-full border rounded px-3 py-2" placeholder="è¾“å…¥å†…å®¹..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">è¯„ä»·æ¨¡å‹</label>
                            <select v-model="evalModel" class="w-full border rounded px-3 py-2">
                                <option value="free">DeepSeek å…è´¹æ¨¡å‹</option>
                                <option value="chat">DeepSeek Chat (ä»˜è´¹)</option>
                                <option value="v3">DeepSeek V3</option>
                            </select>
                        </div>
                        <button @click="evaluate" :disabled="evaluating" class="w-full px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400">
                            {{evaluating ? 'è¯„ä»·ä¸­...' : 'âœ¨ å¼€å§‹è¯„ä»·'}}
                        </button>
                    </div>
                </div>

                <!-- è¯„ä»·ç»“æœ -->
                <div v-if="currentResult" class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-xl font-bold text-gray-900 mb-2">{{currentResult.title}}</h2>
                            <p class="text-sm text-gray-500">è¯„ä»·æ—¶é—´ï¼š{{currentResult.evaluated_at}}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl font-bold" :class="getScoreColor(currentResult.total_score)">{{currentResult.total_score}}</div>
                            <div class="text-lg font-semibold">{{currentResult.grade}}çº§ - {{currentResult.recommendation}}</div>
                        </div>
                    </div>

                    <!-- 5 ç»´é›·è¾¾å›¾ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div><h3 class="text-sm font-semibold text-gray-700 mb-2">ğŸ“Š 5 ç»´è¯„åˆ†</h3><canvas ref="radarChart"></canvas></div>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-2">ğŸ“ˆ è¯¦ç»†è¯„åˆ†</h3>
                            <div class="space-y-3">
                                <div v-for="(score, dim) in currentResult.scores" :key="dim" class="flex items-center gap-2">
                                    <span class="text-xs w-20">{{getDimensionName(dim)}}</span>
                                    <div class="flex-1 bg-gray-200 rounded-full h-3"><div class="bg-blue-500 h-3 rounded-full" :style="{width: score + '%'}"></div></div>
                                    <span class="text-xs w-10 text-right font-semibold">{{score}}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¼˜ç‚¹å’Œå»ºè®® -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-2">âœ… ä¼˜ç‚¹</h3>
                            <ul class="space-y-2">
                                <li v-for="(s, i) in currentResult.strengths" :key="i" class="flex items-start gap-2 text-sm text-gray-700">
                                    <span class="text-green-500 mt-1">âœ“</span><span>{{s}}</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-700 mb-2">ğŸ’¡ æ”¹è¿›å»ºè®®</h3>
                            <ul class="space-y-2">
                                <li v-for="(s, i) in currentResult.improvements" :key="i" class="flex items-start gap-2 text-sm text-gray-700">
                                    <span class="text-orange-500 mt-1">!</span><span>{{s}}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">è¯„ä»·æ€»æ•°</div>
                        <div class="text-2xl font-bold text-blue-600">{{stats.total || 0}}</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">å¹³å‡è¯„åˆ†</div>
                        <div class="text-2xl font-bold text-green-600">{{stats.avg_score || 0}}</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">S çº§çˆ†æ¬¾</div>
                        <div class="text-2xl font-bold text-yellow-600">{{stats.grades?.S || 0}}</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">A çº§ä¼˜è´¨</div>
                        <div class="text-2xl font-bold text-blue-600">{{stats.grades?.A || 0}}</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">ç»Ÿè®¡å‘¨æœŸ</div>
                        <div class="text-2xl font-bold text-purple-600">{{stats.period || '7 å¤©'}}</div>
                    </div>
                </div>

                <!-- è¯„ä»·å†å² -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-4 py-3 border-b">
                        <h2 class="text-lg font-semibold">è¯„ä»·å†å²</h2>
                        <p class="text-sm text-gray-500">æœ€è¿‘ {{history.length}} æ¡è¯„ä»·</p>
                    </div>
                    <div class="divide-y">
                        <div v-for="(item, i) in history" :key="i" class="p-4 hover:bg-gray-50 cursor-pointer" @click="showHistoryDetail(item)">
                            <div class="flex justify-between items-center">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs px-2 py-0.5 rounded" :class="item.target_type==='article'?'bg-blue-100':'bg-purple-100'">{{item.target_type==='article'?'ğŸ“„ æ–‡ç« ':'ğŸ¯ é€‰é¢˜'}}</span>
                                        <span class="text-xs text-gray-500">{{formatTime(item.created_at)}}</span>
                                    </div>
                                    <h3 class="font-semibold">{{item.comment?.substring(0, 80) || 'è¯„ä»·è®°å½•'}}...</h3>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl font-bold" :class="getScoreColor(item.total_score)">{{item.total_score}}</div>
                                    <div class="text-sm font-semibold">{{item.grade}}çº§</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/components-loader.js"></script>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    isDark: false, isSidebarOpen: false,
                    evalType: 'article', evalModel: 'v3',
                    inputTitle: '', inputContent: '',
                    evaluating: false, currentResult: null,
                    stats: {}, history: [], chart: null,
                    modules: [{id:'hotnews',name:'çƒ­ç‚¹ä¸­å¿ƒ',icon:'ğŸ”¥',url:'v3_hotnews_center_v2.html'},{id:'topics',name:'æ™ºèƒ½é€‰é¢˜',icon:'ğŸ¯',url:'v3_topic_intelligence_v2.html'},{id:'evaluation',name:'å·¥ä½œè¯„ä»·',icon:'ğŸ“Š',url:'v3_evaluation_v2.html'},{id:'publish',name:'è‡ªåŠ¨å‘å¸ƒ',icon:'ğŸ“',url:'v3_publish_center_v2.html'},{id:'dashboard',name:'æ•°æ®çœ‹æ¿',icon:'ğŸ“ˆ',url:'v3_data_dashboard_v2.html'}],
                    sidebarItems: [{id:'home',name:'è¿”å›é¦–é¡µ',icon:'ğŸ ',url:'v3_portal_v2.html'},{id:'favorite',name:'æˆ‘çš„æ”¶è—',icon:'â­',url:'#'},{id:'recent',name:'æœ€è¿‘è®¿é—®',icon:'ğŸ•',url:'#'},{id:'settings',name:'ç³»ç»Ÿè®¾ç½®',icon:'âš™ï¸',url:'v3_user_center_v2.html'}]
                }
            },
            methods: {
                toggleSidebar() { this.isSidebarOpen = !this.isSidebarOpen; },
                toggleTheme() { this.isDark = !this.isDark; document.documentElement.classList.toggle('dark', this.isDark); localStorage.setItem('theme', this.isDark ? 'dark' : 'light'); },
                async evaluate() {
                    if (!this.inputTitle || !this.inputContent) { alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹'); return; }
                    this.evaluating = true;
                    setTimeout(() => {
                        this.currentResult = this.getMockResult();
                        this.stats = {total: 10, avg_score: 75.5, grades: {S: 2, A: 3, B: 4}, period: '7 å¤©'};
                        this.evaluating = false;
                        this.$nextTick(() => this.renderRadarChart());
                    }, 2000);
                },
                getMockResult() {
                    return {
                        title: this.inputTitle,
                        scores: {content: 85, structure: 80, expression: 75, viral: 90, innovation: 70},
                        total_score: 82, grade: 'A',
                        strengths: ['å†…å®¹å……å®', 'ç»“æ„æ¸…æ™°', 'æ•°æ®æ”¯æ’‘å……åˆ†'],
                        improvements: ['å¢åŠ æ¡ˆä¾‹', 'ä¼˜åŒ–å¼€å¤´', 'å‡åç»“å°¾'],
                        recommendation: 'æ­£å¸¸å‘å¸ƒ',
                        evaluated_at: new Date().toISOString()
                    };
                },
                renderRadarChart() {
                    const ctx = this.$refs.radarChart; if (!ctx) return;
                    if (this.chart) this.chart.destroy();
                    const scores = this.currentResult.scores || {};
                    this.chart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: Object.keys(scores).map(k => this.getDimensionName(k)),
                            datasets: [{label: 'è¯„åˆ†', data: Object.values(scores), backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgb(59, 130, 246)', pointBackgroundColor: 'rgb(59, 130, 246)'}]
                        },
                        options: {scales: {r: {suggestedMin: 0, suggestedMax: 100}}, plugins: {legend: {display: false}}}
                    });
                },
                getDimensionName(dim) { const names = {content:'å†…å®¹', structure:'ç»“æ„', expression:'è¡¨è¾¾', viral:'ä¼ æ’­', innovation:'åˆ›æ–°', heat:'çƒ­åº¦', potential:'æ½œåŠ›', match:'åŒ¹é…', novelty:'æ–°é¢–', feasibility:'å¯è¡Œ'}; return names[dim] || dim; },
                getScoreColor(score) { if (!score) return 'text-gray-400'; if (score >= 90) return 'text-yellow-600'; if (score >= 80) return 'text-blue-600'; if (score >= 70) return 'text-green-600'; if (score >= 60) return 'text-orange-600'; return 'text-red-600'; },
                formatTime(timeStr) { if (!timeStr) return '-'; return new Date(timeStr).toLocaleString('zh-CN', {month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}); },
                showHistoryDetail(item) { this.currentResult = {...item, scores: {content: item.content_score, structure: item.structure_score, expression: item.expression_score, viral: item.viral_score, innovation: item.innovation_score}}; this.$nextTick(() => this.renderRadarChart()); }
            },
            mounted() { loadComponents({title: 'å·¥ä½œè¯„ä»·', breadcrumbs: ['é¦–é¡µ', 'å·¥ä½œè¯„ä»·']}); this.stats = {total: 10, avg_score: 75.5, grades: {S: 2, A: 3, B: 4}, period: '7 å¤©'}; this.history = Array.from({length: 10}, (_, i) => ({id: i, target_type: i%2?'article':'topic', total_score: 60+Math.random()*40, grade: ['S','A','B','C'][i%4], comment: 'è¯„ä»·ç¤ºä¾‹', created_at: new Date().toISOString()})); }
        }).mount('#app');
    </script>
</body>
</html>
