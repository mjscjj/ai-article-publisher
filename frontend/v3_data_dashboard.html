<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®çœ‹æ¿ - V3 Analytics Dashboard</title>
    <link rel="stylesheet" href="css/v3-design-tokens.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: #48bb78;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        .stat-card .label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            color: #333;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-card .trend {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .trend.up {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .trend.down {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .chart-card h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #667eea;
        }
        
        .chart-container {
            width: 100%;
            height: 350px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .table-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .table-card h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            color: #4a5568;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
        
        .error {
            background: #fed7d7;
            color: #742a2a;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .refresh-indicator {
            display: inline-block;
            margin-left: 8px;
            font-size: 12px;
            color: #666;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinning {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ“Š æ•°æ®çœ‹æ¿</h1>
            <div class="subtitle">å®æ—¶æ•°æ®ç»Ÿè®¡ä¸åˆ†æ | V3 Analytics Dashboard</div>
            <div class="controls">
                <button class="control-btn active" onclick="setPeriod(1)">1 å°æ—¶</button>
                <button class="control-btn" onclick="setPeriod(24)">24 å°æ—¶</button>
                <button class="control-btn" onclick="setPeriod(168)">7 å¤©</button>
                <button class="control-btn" onclick="refreshData()">
                    <span id="refresh-icon">ğŸ”„</span> åˆ·æ–°
                </button>
                <button class="control-btn" onclick="exportReport()">ğŸ“¥ å¯¼å‡ºæŠ¥è¡¨</button>
            </div>
            <div class="refresh-indicator">
                æœ€åæ›´æ–°ï¼š<span id="last-update">--</span>
            </div>
        </div>
        
        <!-- é”™è¯¯æç¤º -->
        <div id="error-container"></div>
        
        <!-- åŠ è½½æç¤º -->
        <div id="loading" class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div id="stats-container" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">çƒ­ç‚¹æ€»æ•°</div>
                    <div class="value" id="stat-hotspots">0</div>
                    <div class="trend up" id="trend-hotspots">--</div>
                </div>
                <div class="stat-card">
                    <div class="label">é€‰é¢˜æ•°é‡</div>
                    <div class="value" id="stat-topics">0</div>
                    <div class="trend" id="trend-topics">--</div>
                </div>
                <div class="stat-card">
                    <div class="label">æ–‡ç« ç”Ÿæˆ</div>
                    <div class="value" id="stat-articles">0</div>
                    <div class="trend" id="trend-articles">--</div>
                </div>
                <div class="stat-card">
                    <div class="label">å‘å¸ƒæ•°é‡</div>
                    <div class="value" id="stat-publish">0</div>
                    <div class="trend" id="trend-publish">--</div>
                </div>
            </div>
            
            <!-- å›¾è¡¨ -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>ğŸ“ˆ çƒ­åº¦è¶‹åŠ¿</h3>
                    <div id="heat-trend-chart" class="chart-container"></div>
                </div>
                <div class="chart-card">
                    <h3>ğŸ“Š åˆ†ç±»åˆ†å¸ƒ</h3>
                    <div id="category-chart" class="chart-container"></div>
                </div>
                <div class="chart-card full-width">
                    <h3>ğŸ”¥ Top 10 çƒ­ç‚¹</h3>
                    <div id="top-hotspots-chart" class="chart-container"></div>
                </div>
                <div class="chart-card">
                    <h3>ğŸ·ï¸ å…³é”®è¯è¶‹åŠ¿</h3>
                    <div id="keyword-chart" class="chart-container"></div>
                </div>
                <div class="chart-card">
                    <h3>âš¡ API æ€§èƒ½</h3>
                    <div id="performance-chart" class="chart-container"></div>
                </div>
            </div>
            
            <!-- æ•°æ®è¡¨æ ¼ -->
            <div class="tables-grid">
                <div class="table-card">
                    <h3>ğŸ“‹ çƒ­é—¨é¡µé¢</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>é¡µé¢</th>
                                <th>è®¿é—®é‡</th>
                                <th>å¹³å‡æ—¶é•¿</th>
                            </tr>
                        </thead>
                        <tbody id="popular-pages-table"></tbody>
                    </table>
                </div>
                <div class="table-card">
                    <h3>âš ï¸ å¼‚å¸¸æ£€æµ‹</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>ç±»å‹</th>
                                <th>æ•°å€¼</th>
                            </tr>
                        </thead>
                        <tbody id="anomalies-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentPeriod = 24; // å°æ—¶
        let charts = {};
        
        // API åŸºç¡€åœ°å€
        const API_BASE = '/api/v3/analytics';
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            refreshData();
            
            // è‡ªåŠ¨åˆ·æ–° (æ¯ 5 åˆ†é’Ÿ)
            setInterval(refreshData, 5 * 60 * 1000);
        });
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            charts.heatTrend = echarts.init(document.getElementById('heat-trend-chart'));
            charts.category = echarts.init(document.getElementById('category-chart'));
            charts.topHotspots = echarts.init(document.getElementById('top-hotspots-chart'));
            charts.keyword = echarts.init(document.getElementById('keyword-chart'));
            charts.performance = echarts.init(document.getElementById('performance-chart'));
            
            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', function() {
                Object.values(charts).forEach(chart => chart.resize());
            });
        }
        
        // è®¾ç½®ç»Ÿè®¡å‘¨æœŸ
        function setPeriod(hours) {
            currentPeriod = hours;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            refreshData();
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            const loading = document.getElementById('loading');
            const statsContainer = document.getElementById('stats-container');
            const errorContainer = document.getElementById('error-container');
            const refreshIcon = document.getElementById('refresh-icon');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loading.style.display = 'block';
            statsContainer.style.display = 'none';
            errorContainer.innerHTML = '';
            refreshIcon.classList.add('spinning');
            
            try {
                // è·å–ä»ªè¡¨ç›˜æ•°æ®
                const response = await fetch(`${API_BASE}/dashboard?hours=${currentPeriod}`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'æ•°æ®åŠ è½½å¤±è´¥');
                }
                
                const data = result.data;
                
                // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
                updateStatsCards(data);
                
                // æ›´æ–°å›¾è¡¨
                updateCharts(data);
                
                // æ›´æ–°è¡¨æ ¼
                updateTables(data);
                
                // æ˜¾ç¤ºå†…å®¹
                loading.style.display = 'none';
                statsContainer.style.display = 'block';
                
                // æ›´æ–°æ—¶é—´
                document.getElementById('last-update').textContent = new Date().toLocaleString('zh-CN');
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                errorContainer.innerHTML = `
                    <div class="error">
                        <strong>âŒ æ•°æ®åŠ è½½å¤±è´¥:</strong> ${error.message}
                    </div>
                `;
                loading.style.display = 'none';
            } finally {
                refreshIcon.classList.remove('spinning');
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStatsCards(data) {
            const realtime = data.realtime_stats || {};
            
            // çƒ­ç‚¹
            const hotspots = realtime.hotspots || {};
            document.getElementById('stat-hotspots').textContent = hotspots.total || 0;
            
            // é€‰é¢˜
            const topics = realtime.topics || {};
            document.getElementById('stat-topics').textContent = topics.total || 0;
            
            // æ–‡ç« 
            const articles = realtime.articles || {};
            document.getElementById('stat-articles').textContent = articles.total || 0;
            
            // å‘å¸ƒ
            const publish = realtime.publish || {};
            document.getElementById('stat-publish').textContent = publish.total_published || 0;
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts(data) {
            // çƒ­åº¦è¶‹åŠ¿å›¾
            const heatTrendData = data.heat_trend || {};
            const dailyData = heatTrendData.daily_data || [];
            
            charts.heatTrend.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data: ['æ•°é‡', 'å¹³å‡åˆ†'] },
                xAxis: {
                    type: 'category',
                    data: dailyData.map(d => d.date)
                },
                yAxis: [
                    { type: 'value', name: 'æ•°é‡' },
                    { type: 'value', name: 'å¹³å‡åˆ†' }
                ],
                series: [
                    {
                        name: 'æ•°é‡',
                        type: 'bar',
                        data: dailyData.map(d => d.count),
                        itemStyle: { color: '#667eea' }
                    },
                    {
                        name: 'å¹³å‡åˆ†',
                        type: 'line',
                        yAxisIndex: 1,
                        data: dailyData.map(d => d.avg_score),
                        itemStyle: { color: '#48bb78' }
                    }
                ]
            });
            
            // åˆ†ç±»åˆ†å¸ƒå›¾
            const categoryTrend = data.category_trend || {};
            const trends = categoryTrend.trends || {};
            
            const categoryNames = Object.keys(trends);
            const categoryValues = Object.values(trends).map(t => {
                const trend = t || {};
                return trend.change_rate || 0;
            });
            
            charts.category.setOption({
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: categoryNames,
                    axisLabel: { rotate: 45 }
                },
                yAxis: { type: 'value', name: 'å˜åŒ–ç‡ (%)' },
                series: [{
                    type: 'bar',
                    data: categoryValues,
                    itemStyle: {
                        color: function(params) {
                            return params.value >= 0 ? '#48bb78' : '#f56565';
                        }
                    }
                }]
            });
            
            // Top 10 çƒ­ç‚¹å›¾
            const topHotspots = (realtime.hotspots || {}).top_hotspots || [];
            
            charts.topHotspots.setOption({
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: topHotspots.map(h => h.title?.substring(0, 15) + '...'),
                    axisLabel: { rotate: 45, interval: 0 }
                },
                yAxis: { type: 'value', name: 'çƒ­åº¦åˆ†' },
                series: [{
                    type: 'bar',
                    data: topHotspots.map(h => h.heat_score),
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#667eea' },
                            { offset: 1, color: '#764ba2' }
                        ])
                    }
                }]
            });
            
            // å…³é”®è¯è¶‹åŠ¿å›¾
            const keywordTrends = data.keyword_trends || [];
            const topKeywords = keywordTrends.slice(0, 15);
            
            charts.keyword.setOption({
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: topKeywords.map(k => k.keyword),
                    axisLabel: { rotate: 45 }
                },
                yAxis: { type: 'value', name: 'å¢é•¿ç‡ (%)' },
                series: [{
                    type: 'line',
                    data: topKeywords.map(k => k.growth_rate),
                    itemStyle: { color: '#ed8936' },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(237, 137, 54, 0.3)' },
                            { offset: 1, color: 'rgba(237, 137, 54, 0.1)' }
                        ])
                    }
                }]
            });
            
            // API æ€§èƒ½å›¾
            const perfData = data.api_performance || {};
            const endpointStats = perfData.by_endpoint || [];
            
            charts.performance.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data: ['è°ƒç”¨æ¬¡æ•°', 'å¹³å‡å“åº”æ—¶é—´'] },
                xAxis: {
                    type: 'category',
                    data: endpointStats.slice(0, 10).map(e => e.endpoint?.substring(0, 20)),
                    axisLabel: { rotate: 45 }
                },
                yAxis: [
                    { type: 'value', name: 'è°ƒç”¨æ¬¡æ•°' },
                    { type: 'value', name: 'å“åº”æ—¶é—´ (ms)' }
                ],
                series: [
                    {
                        name: 'è°ƒç”¨æ¬¡æ•°',
                        type: 'bar',
                        data: endpointStats.slice(0, 10).map(e => e.count),
                        itemStyle: { color: '#4299e1' }
                    },
                    {
                        name: 'å¹³å‡å“åº”æ—¶é—´',
                        type: 'line',
                        yAxisIndex: 1,
                        data: endpointStats.slice(0, 10).map(e => e.avg_time || 0),
                        itemStyle: { color: '#ecc94b' }
                    }
                ]
            });
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTables(data) {
            // çƒ­é—¨é¡µé¢
            const popularPages = data.popular_pages || [];
            const pagesTable = document.getElementById('popular-pages-table');
            pagesTable.innerHTML = popularPages.slice(0, 10).map(page => `
                <tr>
                    <td>${page.page_url?.substring(0, 40) || 'N/A'}</td>
                    <td>${page.views || 0}</td>
                    <td>${page.avg_duration ? Math.round(page.avg_duration) + 's' : 'N/A'}</td>
                </tr>
            `).join('');
            
            // å¼‚å¸¸æ£€æµ‹
            const anomalies = data.anomalies || [];
            const anomaliesTable = document.getElementById('anomalies-table');
            anomaliesTable.innerHTML = anomalies.slice(0, 10).map(a => `
                <tr>
                    <td>${a.date}</td>
                    <td>
                        <span style="color: ${a.type === 'spike' ? '#48bb78' : '#f56565'}">
                            ${a.type === 'spike' ? 'ğŸ“ˆ æ¿€å¢' : 'ğŸ“‰ ä¸‹é™'}
                        </span>
                    </td>
                    <td>${a.count} (Z: ${a.z_score})</td>
                </tr>
            `).join('');
            
            if (anomalies.length === 0) {
                anomaliesTable.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">æš‚æ— å¼‚å¸¸æ•°æ®</td></tr>';
            }
        }
        
        // å¯¼å‡ºæŠ¥è¡¨
        async function exportReport() {
            try {
                const response = await fetch(`${API_BASE}/export/report?hours=${currentPeriod}`);
                const result = await response.json();
                
                if (result.success) {
                    // ä¸‹è½½ JSON æ–‡ä»¶
                    const blob = new Blob([JSON.stringify(result.data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `analytics_report_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            } catch (error) {
                alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
            }
        }
    </script>

        <script>
        // V3 å…¨å±€å‘½åç©ºé—´
        window.V3 = window.V3 || {};

        // å·¥å…·å‡½æ•°
        V3.Utils = {
            storage: {
                get: function(key) {
                    try {
                        return JSON.parse(localStorage.getItem('v3_' + key));
                    } catch (e) {
                        return null;
                    }
                },
                set: function(key, value) {
                    localStorage.setItem('v3_' + key, JSON.stringify(value));
                }
            },
            copyToClipboard: async function(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (e) {
                    return false;
                }
            }
        };

        // ä¸»é¢˜ç®¡ç†
        V3.Theme = {
            toggle: function() {
                const current = document.documentElement.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                V3.Utils.storage.set('theme', next);
            },
            init: function() {
                const saved = V3.Utils.storage.get('theme') || 'light';
                document.documentElement.setAttribute('data-theme', saved);
            }
        };

        // é€šçŸ¥ç³»ç»Ÿ
        V3.Notification = {
            show: function(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = 'v3-toast v3-toast-' + type;
                toast.textContent = message;
                toast.style.cssText = 'position:fixed;top:80px;right:24px;padding:12px 24px;background:var(--color-neutral-900);color:white;border-radius:8px;z-index:9999;animation:slideIn 0.3s ease;';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },
            info: function(msg) { this.show(msg, 'info'); },
            success: function(msg) { this.show(msg, 'success'); },
            error: function(msg) { this.show(msg, 'error'); }
        };

        // ç”¨æˆ·ç®¡ç†
        V3.User = {
            isLoggedIn: function() { return true; },
            getUser: function() { return { name: 'Admin', role: 'ç®¡ç†å‘˜' }; },
            logout: function() { V3.Notification.info('é€€å‡ºç™»å½•åŠŸèƒ½å¼€å‘ä¸­...'); }
        };

        // ä¾§è¾¹æ ç®¡ç†
        V3.Sidebar = {
            toggle: function() {
                const sidebar = document.querySelector('.v3-sidebar');
                const breadcrumb = document.querySelector('.v3-breadcrumb');
                if (sidebar) {
                    sidebar.classList.toggle('collapsed');
                    if (breadcrumb) {
                        breadcrumb.classList.toggle('sidebar-collapsed');
                    }
                }
            },
            renderRecent: function() {
                const container = document.getElementById('v3-sidebar-recent');
                if (!container) return;
                const recent = V3.Utils.storage.get('recent_pages') || [];
                if (recent.length === 0) {
                    container.innerHTML = '<div style="padding:10px 12px;color:var(--color-neutral-500);font-size:0.875rem;">æš‚æ— æœ€è¿‘è®¿é—®</div>';
                    return;
                }
                container.innerHTML = recent.slice(0, 5).map(item => 
                    '<a href="' + item.url + '" class="v3-sidebar-item" title="' + item.title + '">' +
                    '<span class="v3-sidebar-item-icon">ğŸ•</span>' +
                    '<span class="v3-sidebar-item-label">' + item.title + '</span></a>'
                ).join('');
            },
            clearRecent: function() {
                V3.Utils.storage.set('recent_pages', []);
                V3.Sidebar.renderRecent();
                V3.Notification.success('å·²æ¸…ç©ºæœ€è¿‘è®¿é—®');
            },
            recordVisit: function(title, url) {
                const recent = V3.Utils.storage.get('recent_pages') || [];
                const filtered = recent.filter(item => item.url !== url);
                filtered.unshift({ title, url, timestamp: Date.now() });
                V3.Utils.storage.set('recent_pages', filtered.slice(0, 10));
                V3.Sidebar.renderRecent();
            }
        };

        // é¢åŒ…å±‘å¯¼èˆª
        V3.Breadcrumb = {
            share: async function() {
                const url = window.location.href;
                const success = await V3.Utils.copyToClipboard(url);
                if (success) V3.Notification.success('é“¾æ¥å·²å¤åˆ¶');
                else V3.Notification.error('å¤åˆ¶å¤±è´¥');
            }
        };

        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // Ctrl+K: å…¨å±€æœç´¢ï¼ˆé¢„ç•™ï¼‰
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                V3.Notification.info('å…¨å±€æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
            }
            // Ctrl+B: åˆ‡æ¢ä¾§è¾¹æ 
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                V3.Sidebar.toggle();
            }
            // Ctrl+R: åˆ·æ–°
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                window.location.reload();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            V3.Theme.init();
            V3.Sidebar.renderRecent();
            V3.Sidebar.recordVisit('æ•°æ®çœ‹æ¿', window.location.pathname);
            
            // é«˜äº®å½“å‰æ¨¡å—
            const currentPath = window.location.pathname.split('/').pop();
            document.querySelectorAll('.v3-navbar-link, .v3-sidebar-item').forEach(el => {
                const href = el.getAttribute('href');
                if (href && href === currentPath) {
                    el.classList.add('active');
                }
            });
        });

        // ç”¨æˆ·èœå•åˆ‡æ¢
        document.addEventListener('click', function(e) {
            const userMenu = document.querySelector('.v3-navbar-user');
            if (userMenu && !userMenu.contains(e.target)) {
                userMenu.setAttribute('aria-expanded', 'false');
            }
        });
        </script>

</body>
</html>
