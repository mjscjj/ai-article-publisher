#!/usr/bin/env python3
"""
ã€V2ã€‘æ·±åº¦å†™ä½œ Prompt å·¥å…·ç®± (Prompt Toolkit)
æä¾›æ¨¡å—åŒ–çš„å†™ä½œæŠ€å·§ã€æ¡†æ¶å’Œå AI å‘³çº¦æŸï¼Œé€šè¿‡ç»„åˆæ‹¼è£…ç”Ÿæˆç¥çº§ Promptã€‚
æ”¯æŒè¢« pipeline_v2 ç­‰è‡ªåŠ¨åŒ–æµå¼•å…¥ï¼Œå¯æŒ‰éœ€åŠ¨æ€å¼€å¯ç‰¹æ•ˆã€‚
"""
import json

TECHNIQUES = {
    "scqa_framework": """
ã€ç»“æ„æ¡†æ¶ï¼šSCQA å™äº‹æ³•åˆ™ã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ SCQA ç»“æ„æ¨è¿›æ–‡ç« é€»è¾‘ï¼Œç”¨æ— ç¼çš„å™äº‹è¿‡æ¸¡ï¼Œè€Œä¸æ˜¯ç”Ÿç¡¬çš„æ¨¡å—åŒ–æ ‡é¢˜ï¼š
- S (Situation/æƒ…å¢ƒ)ï¼šç”¨ä¸€ä¸ªå…·ä½“ã€å¾®è§‚çš„çœŸå®ç»†èŠ‚æˆ–æ•°æ®äº‹å®å¼€åœºï¼Œå»ºç«‹ç¨³å®šçš„èƒŒæ™¯æˆ–ç”»é¢æ„Ÿã€‚
- C (Complication/å†²çª)ï¼šæŠ›å‡ºä¸€ä¸ªæ‰“ç ´ç°çŠ¶çš„çŸ›ç›¾ã€å±æœºã€æˆ–è€…è¿èƒŒç›´è§‰çš„åå¸¸ç°è±¡ã€‚
- Q (Question/ç–‘é—®)ï¼šå¼•å¯¼å‡ºæ ¸å¿ƒç–‘é—®ï¼ŒæŠŠè¯»è€…çš„èƒƒå£åŠèµ·æ¥ã€‚
- A (Answer/è§£ç­”)ï¼šé€šè¿‡æ·±åº¦è§£æå’Œé€’è¿›é€»è¾‘ï¼Œç»™å‡ºä½ çš„æ·±åˆ»æ´å¯Ÿä¸ç»ˆå±€ç­”æ¡ˆã€‚
""",

    "inverted_pyramid": """
ã€ç»“æ„æ¡†æ¶ï¼šå€’é‡‘å­—å¡”ç»“æ„ã€‘
- ç¬¬ä¸€æ®µï¼šç›´æ¥æŠ›å‡ºæœ€é‡è¦çš„ç»“è®º/æ–°é—»ç‚¹ï¼ˆ5W1H é½å…¨ï¼‰
- ç¬¬äºŒæ®µï¼šè¡¥å……å…³é”®èƒŒæ™¯å’Œæ”¯æ’‘æ•°æ®
- ç¬¬ä¸‰æ®µåŠä»¥åï¼šé€æ­¥å±•å¼€ç»†èŠ‚ã€å¼•ç”¨ã€åˆ†æ
- é€‚ç”¨äºï¼šæ–°é—»æŠ¥é“ã€å¿«è®¯ã€æ”¿ç­–è§£è¯»
""",

    "story_arc": """
ã€ç»“æ„æ¡†æ¶ï¼šè‹±é›„ä¹‹æ—…å™äº‹å¼§ã€‘
- èµ·ç‚¹ï¼šå¹³å‡¡ä¸–ç•Œï¼ˆæè¿°ç°çŠ¶ï¼‰
- å¬å”¤ï¼šå˜é©ä¿¡å·ï¼ˆæŸä¸ªäº‹ä»¶æ‰“ç ´å¹³é™ï¼‰
- æŒ£æ‰ï¼šå†²çªä¸å›°å¢ƒï¼ˆå„æ–¹åšå¼ˆã€çŸ›ç›¾å‡çº§ï¼‰
- é¡¿æ‚Ÿï¼šå…³é”®è½¬æŠ˜ï¼ˆæŸä¸ªæ´å¯Ÿæˆ–çªç ´ï¼‰
- å›å½’ï¼šæ–°å¸¸æ€ï¼ˆæ”¹å˜åçš„ä¸–ç•Œï¼‰
- é€‚ç”¨äºï¼šäººç‰©ç‰¹å†™ã€è¡Œä¸šå˜é©ã€æ·±åº¦æŠ¥é“
""",

    "latepost_style": """
ã€æ–‡é£è°ƒæ€§ï¼šé¡¶çº§å•†ä¸šç§‘æŠ€è§‚å¯Ÿé£ã€‘
- è¯­è¨€é”‹åˆ©ã€å…‹åˆ¶ã€ä¸€é’ˆè§è¡€ã€‚ç”¨çŸ­å¥å’Œé‡‘å¥ï¼Œæ‹’ç»é•¿ç¯‡å¤§è®ºçš„å®šè¯­ã€‚
- åƒä¸€ä¸ªçœ‹é€å•†ä¸šæœ¬è´¨ã€å¸¦æœ‰å…‹åˆ¶æƒ…ç»ªçš„ã€Šæ™šç‚¹ LatePostã€‹æˆ–ã€Šè™å—…ã€‹èµ„æ·±ä¸»ç¬”åœ¨è®²è¿°ã€‚
- ä½¿ç”¨å¼ºæœ‰åŠ›çš„åŠ¨è¯ã€‚å¤šå±•ç°å†·é…·çš„äº‹å®ã€æ•°å­—å’Œåº•å±‚é€»è¾‘ï¼Œæå°‘æŠ’å‘å»‰ä»·çš„æ„Ÿæ…¨å’Œä¸»è§‚å½¢å®¹è¯ã€‚
""",

    "caijing_style": """
ã€æ–‡é£è°ƒæ€§ï¼šè´¢ç»æ·±åº¦æŠ¥é“é£ã€‘
- ä¸“ä¸šã€ä¸¥è°¨ã€æ•°æ®é©±åŠ¨
- å¤§é‡å¼•ç”¨è´¢æŠ¥æ•°æ®ã€è¡Œä¸šæŠ¥å‘Šã€ä¸“å®¶è®¿è°ˆ
- ç»“æ„æ¸…æ™°ï¼Œè®ºè¯ä¸¥å¯†ï¼Œé€‚åˆ B ç«¯è¯»è€…
- é€‚ç”¨äºï¼šè¡Œä¸šåˆ†æã€å…¬å¸æ·±åº¦ã€æŠ•èèµ„æŠ¥é“
""",

    "academic_humor": """
ã€æ–‡é£è°ƒæ€§ï¼šå­¦æœ¯åšå£«å¹½é»˜é£ã€‘
- èåˆå­¦æœ¯æ·±åº¦ä¸è½»æ¾å¹½é»˜
- å¼•ç”¨ç»å…¸ç†è®ºä½†ç”¨å¤§ç™½è¯è§£é‡Š
- é€‚å½“è‡ªå˜²ã€ç©æ¢—ï¼Œä½†ä¸ä½ä¿—
- é€‚ç”¨äºï¼šæ•™è‚²è¯é¢˜ã€çŸ¥è¯†ç§‘æ™®ã€é’å¹´æˆé•¿
""",

    "first_person": """
ã€æ–‡é£è°ƒæ€§ï¼šç¬¬ä¸€äººç§°äº²å†è€…é£ã€‘
- ç”¨"æˆ‘"çš„è§†è§’è®²è¿°ï¼Œå¢å¼ºä»£å…¥æ„Ÿ
- å¤§é‡ç»†èŠ‚æå†™ã€å¿ƒç†æ´»åŠ¨
- æƒ…æ„ŸçœŸæŒšï¼Œæœ‰æ¸©åº¦
- é€‚ç”¨äºï¼šä¸ªäººæ•…äº‹ã€ä½“éªŒæŠ¥å‘Šã€è§‚ç‚¹è¯„è®º
""",

    "anti_ai_formatting": """
ã€ğŸŒŸ å¼ºåˆ¶æ’ç‰ˆä¸å AI ç—•è¿¹ç»å¯¹çº¦æŸ ğŸŒŸã€‘
- ç»å¯¹ç¦æ­¢ä½¿ç”¨"- "ã€"1. 2. 3."ã€"ç¬¬ä¸€ï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰"ç­‰é¡¹ç›®ç¬¦å·ï¼ˆBullet pointsï¼‰ã€‚ä½ å¿…é¡»ç”¨å…·æœ‰é€»è¾‘æ¨æ¼”æ„Ÿçš„ã€å®Œæ•´æ®µè½ã€‘æ¥æ¨è¿›å™äº‹ã€‚
- ç»å¯¹ç¦æ­¢ä½¿ç”¨ AI å¥—è¯ï¼šåŒ…æ‹¬ä½†ä¸é™äº"åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£"ã€"éšç€ç§‘æŠ€çš„å‘å±•"ã€"ä¸å¯å¦è®¤"ã€"ç»¼ä¸Šæ‰€è¿°"ã€"æ€»è€Œè¨€ä¹‹"ã€"åœ¨è¿™ä¸ªå……æ»¡æŒ‘æˆ˜ä¸æœºé‡çš„ X é¢†åŸŸ"ã€"æˆ‘ä»¬éœ€è¦å…±åŒåŠªåŠ›"ã€‚å‡ºç°ä¸€å¥å³ä¸ºå¤±è´¥ã€‚
- ç¦ç”¨"æ€»åˆ†æ€»"çš„å…«è‚¡æ–‡ç»“æ„ã€‚é‡‡ç”¨å‰¥æ´‹è‘±å¼çš„çº¿æ€§å™äº‹ï¼Œä¸€å±‚å±‚æ­å¼€æœ¬è´¨ã€‚
""",

    "metaphor_injection": """
ã€ä¿®è¾è¦æ±‚ï¼šéšå–»ä¸é™ç»´æ‰“å‡»ã€‘
- æ–‡ç« ä¸­å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæå…¶å·§å¦™è´´åˆ‡çš„"éšå–»"ï¼ˆMetaphorï¼‰æˆ–å†å²å¯¹æ¯”ã€‚
- ä¾‹ï¼šå°†ç°æœ‰çš„çŸ¥è¯†çŒè¾“æ¯”ä½œ"æ‰‹å·¥ä¸šæ—¶ä»£çš„é“åŒ é“º"ï¼Œæˆ–å°† AI å·¥å…·æ¯”ä½œ"è’¸æ±½æœºæ—¶ä»£çš„ç¬¬ä¸€åº§ç…¤çŸ¿"ã€‚ç”¨å·§å¦™çš„éšå–»å»ºç«‹è®¤çŸ¥è½å·®ã€‚
""",

    "emotional_resonance": """
ã€å…±é¸£é’©å­ï¼šç—›ç‚¹ç©¿é€ã€‘
- å¿…é¡»åœ¨ä¸€ä¸ªæ®µè½é‡Œï¼Œç²¾å‡†æå†™å½“äº‹äººç¾¤ä½“ï¼ˆä¾‹å¦‚ï¼šè¢«å›°åœ¨æµæ°´çº¿æ•™è‚²ä¸­çš„å­¦ç”Ÿã€å®³æ€•è¢«æ·˜æ±°çš„ä¸­å±‚èŒåœºäººï¼‰åœ¨æ·±å¤œæˆ–å·¥ä½œå°å‰çš„å…·ä½“ç„¦è™‘åœºæ™¯ã€‚
- æŠŠå®å¤§çš„æŠ€æœ¯å˜é‡ï¼Œè½åœ°ä¸ºå…·ä½“ä¸ªä½“çš„ç–¼ç—›æ„Ÿã€‚
""",

    "data_driven": """
ã€è®ºè¯æ–¹å¼ï¼šæ•°æ®é©±åŠ¨ã€‘
- æ¯ä¸ªè®ºç‚¹å¿…é¡»é…æœ‰å…·ä½“æ•°æ®æ”¯æ’‘
- ä¼˜å…ˆä½¿ç”¨ç™¾åˆ†æ¯”ã€å€æ•°ã€å¯¹æ¯”æ•°æ®
- æ•°æ®æ¥æºè¦æ ‡æ³¨ï¼ˆå¦‚"æ® XX æŠ¥å‘Šæ˜¾ç¤º"ï¼‰
- é€‚ç”¨äºï¼šè¡Œä¸šåˆ†æã€å¸‚åœºæŠ¥å‘Š
""",

    "quote_heavy": """
ã€è®ºè¯æ–¹å¼ï¼šå¯†é›†å¼•ç”¨ã€‘
- å¤§é‡å¼•ç”¨å½“äº‹äººåŸè¯ã€ä¸“å®¶è§‚ç‚¹ã€ç¤¾äº¤åª’ä½“è¯„è®º
- ç”¨å¼•å·æ ‡æ³¨ç›´æ¥å¼•è¯­ï¼Œå¢å¼ºçœŸå®æ„Ÿ
- å¤šæ–¹è§‚ç‚¹ç¢°æ’ï¼Œå±•ç°äº‰è®®æ€§
- é€‚ç”¨äºï¼šäº‰è®®è¯é¢˜ã€äº‹ä»¶æŠ¥é“
""",
}

# é¢„è®¾é£æ ¼ç»„åˆ
PRESET_STYLES = {
    "commercial_deep": ["scqa_framework", "latepost_style", "anti_ai_formatting", "data_driven"],
    "news_fast": ["inverted_pyramid", "anti_ai_formatting"],
    "story_feature": ["story_arc", "first_person", "emotional_resonance", "metaphor_injection"],
    "academic_edu": ["scqa_framework", "academic_humor", "quote_heavy", "metaphor_injection"],
    "analysis_report": ["scqa_framework", "caijing_style", "data_driven", "anti_ai_formatting"],
}

def build_prompt(topic: str, core_facts: str, selected_techniques: list) -> str:
    """
    ç»„è£… Prompt å¼•æ“
    """
    prompt_parts = []
    prompt_parts.append(f"# æ·±åº¦åˆ›ä½œæ ¸å¿ƒå‘½é¢˜ï¼š{topic}\n")
    
    prompt_parts.append("## æ ¸å¿ƒæ–°é—»äº‹å®ï¼ˆFact-Packï¼‰\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šè¯·åŠ¡å¿…å°†ä»¥ä¸‹çœŸå®æ–°é—»/æ•°æ®ä½œä¸ºæ–‡ç« çš„å¼€ç¯‡åˆ‡å…¥ç‚¹æˆ–å¼ºæœ‰åŠ›çš„è®ºæ®ï¼Œç»ä¸èƒ½è„±ç¦»äº‹å®ç©ºè°ˆï¼š")
    prompt_parts.append(f"{core_facts}\n")
    
    prompt_parts.append("## å†™ä½œé­”ç›’æŠ€å·§åº“ä¸çº¢çº¿çº¦æŸ\nä½ å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹è¢«æ¿€æ´»çš„æ‰€æœ‰å†™ä½œè¦æ±‚æ³•é—¨ï¼š\n")
    for tech in selected_techniques:
        if tech in TECHNIQUES:
            prompt_parts.append(TECHNIQUES[tech])
            
    prompt_parts.append("\nã€æœ€ç»ˆè¾“å‡ºæŒ‡ä»¤ã€‘ï¼šä¸è¦å¸¦æœ‰ä»»ä½•è¯¸å¦‚'å¥½çš„ï¼Œè¿™æ˜¯ä½ è¦çš„æ–‡ç« 'ç­‰å‰ç½®ç¡®è®¤åºŸè¯ã€‚ç›´æ¥è¾“å‡ºçº¯æ­£æ–‡ï¼Œé™¤äº†å¤§æ ‡é¢˜å’Œå°æ ‡é¢˜ï¼Œä¸ä½¿ç”¨å¤šä½™çš„ Markdown åˆ—è¡¨æ ‡è®°ï¼Œå­—æ•°åœ¨ 1500-2000 å­—ä¹‹é—´ï¼Œå±•ç°æè‡´çš„æ–‡å­—å¼ åŠ›ã€‚")
    
    return "\n".join(prompt_parts)


def get_preset(style_name: str) -> list:
    """è·å–é¢„è®¾é£æ ¼ç»„åˆ"""
    return PRESET_STYLES.get(style_name, ["scqa_framework", "anti_ai_formatting"])
    
if __name__ == "__main__":
    # æµ‹è¯•æ‰“å°
    print("å¯ç”¨é£æ ¼ç»„åˆ:")
    for name, techniques in PRESET_STYLES.items():
        print(f"  {name}: {', '.join(techniques)}")
    print("\næµ‹è¯• commercial_deep é£æ ¼:")
    print(build_prompt("æµ‹è¯•è¯é¢˜", "è‹¹æœæ”¾å¼ƒé€ è½¦", get_preset("commercial_deep")))
