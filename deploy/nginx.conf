events {
    worker_connections 1024;
}

http {
    upstream hotnews {
        server hotnews:8000;
    }

    upstream topics {
        server topics:8000;
    }

    upstream evaluation {
        server evaluation:8001;
    }

    upstream review {
        server review:8002;
    }

    upstream coordinator {
        server coordinator:8003;
    }

    upstream publish {
        server publish:8004;
    }

    upstream analytics {
        server analytics:8005;
    }

    upstream workflow {
        server workflow:8006;
    }

    upstream auth {
        server auth:8007;
    }

    server {
        listen 80;
        server_name _;

        # 热点中心
        location /api/v3/hotnews {
            proxy_pass http://hotnews;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 智能选题
        location /api/v3/topics {
            proxy_pass http://topics;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 工作评价
        location /api/v3/evaluation {
            proxy_pass http://evaluation;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 工作 Review
        location /api/v3/review {
            proxy_pass http://review;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 项目协调者
        location /api/v3/coordinator {
            proxy_pass http://coordinator;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 自动发布
        location /api/v3/publish {
            proxy_pass http://publish;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 数据看板
        location /api/v3/analytics {
            proxy_pass http://analytics;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 工作流引擎
        location /api/v3/workflow {
            proxy_pass http://workflow;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 用户认证
        location /api/v3/auth {
            proxy_pass http://auth;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 前端静态文件
        location / {
            root /app/frontend;
            index index.html;
            try_files $uri $uri/ =404;
        }
    }
}
